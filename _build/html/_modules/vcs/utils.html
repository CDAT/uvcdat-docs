<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>vcs.utils &#8212; VCS 2.4.1 documentation</title>
    
    <link rel="stylesheet" href="../../_static/classic.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../',
        VERSION:     '2.4.1',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <link rel="shortcut icon" href="../../_static/globe.png"/>
    <link rel="top" title="VCS 2.4.1 documentation" href="../../index.html" />
    <link rel="up" title="vcs" href="../vcs.html" /> 
  </head>
  <body role="document">
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../index.html">VCS 2.4.1 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../index.html" >Module code</a> &#187;</li>
          <li class="nav-item nav-item-2"><a href="../vcs.html" accesskey="U">vcs</a> &#187;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <h1>Source code for vcs.utils</h1><div class="highlight"><pre>
<span></span><span class="c1"># Adapted for numpy/ma/cdms2 by convertcdms.py</span>
<span class="kn">import</span> <span class="nn">numpy</span>
<span class="kn">import</span> <span class="nn">cdtime</span>
<span class="kn">import</span> <span class="nn">warnings</span>
<span class="kn">import</span> <span class="nn">vcs</span>
<span class="kn">import</span> <span class="nn">boxfill</span>
<span class="kn">import</span> <span class="nn">isofill</span>
<span class="kn">import</span> <span class="nn">isoline</span>
<span class="kn">import</span> <span class="nn">taylor</span>
<span class="kn">import</span> <span class="nn">projection</span>
<span class="kn">import</span> <span class="nn">fillarea</span>
<span class="kn">import</span> <span class="nn">template</span>
<span class="kn">import</span> <span class="nn">texttable</span>
<span class="kn">import</span> <span class="nn">textorientation</span>
<span class="kn">import</span> <span class="nn">line</span>
<span class="kn">import</span> <span class="nn">unified1D</span>
<span class="kn">import</span> <span class="nn">vector</span>
<span class="kn">import</span> <span class="nn">marker</span>
<span class="kn">import</span> <span class="nn">colormap</span>
<span class="kn">import</span> <span class="nn">json</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">tempfile</span>
<span class="kn">import</span> <span class="nn">cdms2</span>
<span class="kn">import</span> <span class="nn">genutil</span>
<span class="kn">import</span> <span class="nn">vtk</span>

<span class="kn">from</span> <span class="nn">colors</span> <span class="k">import</span> <span class="n">rgb2str</span><span class="p">,</span> <span class="n">str2rgb</span><span class="p">,</span> <span class="n">matplotlib2vcs</span>  <span class="c1"># noqa</span>

<span class="n">indent</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">sort_keys</span> <span class="o">=</span> <span class="kc">True</span>


<span class="k">def</span> <span class="nf">process_range_from_old_scr</span><span class="p">(</span><span class="n">code</span><span class="p">,</span> <span class="n">g</span><span class="p">):</span>
    <span class="n">irg</span> <span class="o">=</span> <span class="n">code</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">&quot;range&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">irg</span> <span class="o">&gt;</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
        <span class="n">rg_code</span> <span class="o">=</span> <span class="n">code</span><span class="p">[</span><span class="n">irg</span><span class="p">:]</span>
        <span class="n">levs</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">fac</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">fai</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">fas</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">badfa</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">while</span> <span class="n">rg_code</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">&quot;(id=&quot;</span><span class="p">)</span> <span class="o">&gt;</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
            <span class="n">iend</span> <span class="o">=</span> <span class="n">rg_code</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">&quot;)&quot;</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>
            <span class="n">line</span> <span class="o">=</span> <span class="n">rg_code</span><span class="p">[:</span><span class="n">iend</span><span class="p">]</span>
            <span class="n">rg_code</span> <span class="o">=</span> <span class="n">rg_code</span><span class="p">[</span><span class="n">iend</span><span class="p">:]</span>
            <span class="n">sp</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="p">)</span>
            <span class="n">levs</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="nb">float</span><span class="p">(</span><span class="n">sp</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">7</span><span class="p">:]),</span> <span class="nb">float</span><span class="p">(</span><span class="n">sp</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="mi">7</span><span class="p">:])])</span>
            <span class="n">fa</span> <span class="o">=</span> <span class="n">sp</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="mi">3</span><span class="p">:]</span>
            <span class="n">fa</span> <span class="o">=</span> <span class="n">fa</span><span class="p">[:</span><span class="n">fa</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">&quot;)&quot;</span><span class="p">)]</span>
            <span class="k">if</span> <span class="n">fa</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">vcs</span><span class="o">.</span><span class="n">elements</span><span class="p">[</span><span class="s2">&quot;fillarea&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="n">badfa</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="n">fai</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">fa</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">fa</span> <span class="o">=</span> <span class="n">vcs</span><span class="o">.</span><span class="n">elements</span><span class="p">[</span><span class="s2">&quot;fillarea&quot;</span><span class="p">][</span><span class="n">fa</span><span class="p">]</span>
                <span class="n">fac</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">fa</span><span class="o">.</span><span class="n">color</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
                <span class="n">fai</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">fa</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
                <span class="n">fas</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">fa</span><span class="o">.</span><span class="n">style</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">numpy</span><span class="o">.</span><span class="n">allclose</span><span class="p">(</span><span class="n">levs</span><span class="p">,</span> <span class="mf">1.e20</span><span class="p">):</span>
            <span class="n">g</span><span class="o">.</span><span class="n">levels</span> <span class="o">=</span> <span class="n">levs</span>
        <span class="k">if</span> <span class="n">badfa</span><span class="p">:</span>
            <span class="n">g</span><span class="o">.</span><span class="n">_fillareaindices</span> <span class="o">=</span> <span class="n">fai</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">g</span><span class="o">.</span><span class="n">fillareacolors</span> <span class="o">=</span> <span class="n">fac</span>
            <span class="n">g</span><span class="o">.</span><span class="n">fillareaindices</span> <span class="o">=</span> <span class="n">fai</span>
            <span class="n">g</span><span class="o">.</span><span class="n">fillareastyle</span> <span class="o">=</span> <span class="n">fas</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>


<span class="k">def</span> <span class="nf">dumpToDict</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">skipped</span><span class="o">=</span><span class="p">[],</span> <span class="n">must</span><span class="o">=</span><span class="p">[]):</span>
    <span class="n">dic</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">associated</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;texttable&quot;</span><span class="p">:</span> <span class="nb">set</span><span class="p">(),</span>
                  <span class="s2">&quot;textorientation&quot;</span><span class="p">:</span> <span class="nb">set</span><span class="p">(),</span>
                  <span class="s2">&quot;line&quot;</span><span class="p">:</span> <span class="nb">set</span><span class="p">(),</span>
                  <span class="s2">&quot;colormap&quot;</span><span class="p">:</span> <span class="nb">set</span><span class="p">(),</span>
                  <span class="s2">&quot;projection&quot;</span><span class="p">:</span> <span class="nb">set</span><span class="p">(),</span>
                  <span class="p">}</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="p">(</span><span class="n">vcs</span><span class="o">.</span><span class="n">taylor</span><span class="o">.</span><span class="n">TDMarker</span><span class="p">,</span> <span class="n">vcs</span><span class="o">.</span><span class="n">taylor</span><span class="o">.</span><span class="n">Gtd</span><span class="p">)):</span>
        <span class="k">del</span><span class="p">(</span><span class="n">associated</span><span class="p">[</span><span class="s2">&quot;line&quot;</span><span class="p">])</span>
    <span class="n">associated_keys</span> <span class="o">=</span> <span class="n">associated</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">obj</span><span class="o">.</span><span class="n">__slots__</span><span class="p">:</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">a</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">skipped</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">a</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="s2">&quot;_&quot;</span> <span class="ow">or</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">must</span><span class="p">):</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">val</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">a</span><span class="p">)</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="k">continue</span>
            <span class="k">if</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">associated_keys</span> <span class="ow">and</span> <span class="n">val</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span>
                    <span class="s2">&quot;default&quot;</span><span class="p">,</span> <span class="s2">&quot;defup&quot;</span><span class="p">,</span> <span class="s2">&quot;defcenter&quot;</span><span class="p">,</span> <span class="s2">&quot;defright&quot;</span><span class="p">]:</span>
                <span class="k">if</span> <span class="n">a</span> <span class="o">==</span> <span class="s2">&quot;line&quot;</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span>
                        <span class="n">obj</span><span class="p">,</span> <span class="p">(</span><span class="n">vcs</span><span class="o">.</span><span class="n">isoline</span><span class="o">.</span><span class="n">Gi</span><span class="p">,</span> <span class="n">vcs</span><span class="o">.</span><span class="n">unified1D</span><span class="o">.</span><span class="n">G1d</span><span class="p">)):</span>
                    <span class="k">continue</span>
                <span class="n">associated</span><span class="p">[</span><span class="n">a</span><span class="p">]</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">val</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">val</span><span class="p">,</span>
                              <span class="p">(</span><span class="n">unicode</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">,</span> <span class="nb">list</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="n">long</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">dict</span><span class="p">))</span> <span class="ow">and</span> \
                    <span class="n">val</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">val</span><span class="p">,</span> <span class="n">asso</span> <span class="o">=</span> <span class="n">dumpToDict</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="n">skipped</span><span class="p">,</span> <span class="n">must</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">associated_keys</span><span class="p">:</span>
                    <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">asso</span><span class="p">[</span><span class="n">k</span><span class="p">]:</span>
                        <span class="n">associated</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>
            <span class="n">dic</span><span class="p">[</span><span class="n">a</span><span class="p">]</span> <span class="o">=</span> <span class="n">val</span>
    <span class="k">return</span> <span class="n">dic</span><span class="p">,</span> <span class="n">associated</span>


<span class="k">def</span> <span class="nf">dumpToJson</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">fileout</span><span class="p">,</span> <span class="n">skipped</span><span class="o">=</span><span class="p">[</span>
               <span class="s2">&quot;info&quot;</span><span class="p">,</span> <span class="s2">&quot;member&quot;</span><span class="p">],</span> <span class="n">must</span><span class="o">=</span><span class="p">[],</span> <span class="n">indent</span><span class="o">=</span><span class="n">indent</span><span class="p">,</span> <span class="n">sort_keys</span><span class="o">=</span><span class="n">sort_keys</span><span class="p">):</span>
    <span class="n">dic</span><span class="p">,</span> <span class="n">associated</span> <span class="o">=</span> <span class="n">dumpToDict</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">skipped</span><span class="p">,</span> <span class="n">must</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">fileout</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">fileout</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="n">f</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">fileout</span><span class="p">,</span> <span class="s2">&quot;a+&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">f</span> <span class="o">=</span> <span class="n">fileout</span>
            <span class="n">fileout</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">name</span>
        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">fileout</span><span class="p">):</span>
            <span class="n">st</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">stat</span><span class="p">(</span><span class="n">fileout</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">st</span><span class="o">.</span><span class="n">st_size</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="c1"># Mac needs to rewind, seems ok on other platforms</span>
                    <span class="n">f</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
                    <span class="n">D</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
                <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
                    <span class="nb">print</span> <span class="s2">&quot;Error reading json file,&quot;</span> <span class="o">+</span>\
                        <span class="s2">&quot;will be overwritten&quot;</span><span class="p">,</span> <span class="n">fileout</span><span class="p">,</span> <span class="n">err</span>
                    <span class="n">D</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">D</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">D</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">f</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">fileout</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">N</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;g_name&quot;</span><span class="p">,</span> <span class="s2">&quot;s_name&quot;</span><span class="p">,</span> <span class="s2">&quot;p_name&quot;</span><span class="p">]:</span>
            <span class="k">if</span> <span class="n">N</span> <span class="ow">in</span> <span class="n">dic</span><span class="p">:</span>
                <span class="n">nm</span> <span class="o">=</span> <span class="n">dic</span><span class="p">[</span><span class="n">N</span><span class="p">]</span>
                <span class="k">del</span><span class="p">(</span><span class="n">dic</span><span class="p">[</span><span class="n">N</span><span class="p">])</span>
                <span class="k">break</span>
        <span class="n">d</span> <span class="o">=</span> <span class="n">D</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">nm</span><span class="p">,</span> <span class="p">{})</span>
        <span class="n">nm2</span> <span class="o">=</span> <span class="n">dic</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">]</span>
        <span class="k">del</span><span class="p">(</span><span class="n">dic</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">])</span>
        <span class="n">d</span><span class="p">[</span><span class="n">nm2</span><span class="p">]</span> <span class="o">=</span> <span class="n">dic</span>
        <span class="n">D</span><span class="p">[</span><span class="n">nm</span><span class="p">]</span> <span class="o">=</span> <span class="n">d</span>
        <span class="n">json</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">D</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">sort_keys</span><span class="o">=</span><span class="n">sort_keys</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="n">indent</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">fileout</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
            <span class="k">for</span> <span class="n">etype</span> <span class="ow">in</span> <span class="n">associated</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="k">for</span> <span class="n">asso</span> <span class="ow">in</span> <span class="n">associated</span><span class="p">[</span><span class="n">etype</span><span class="p">]:</span>
                    <span class="k">if</span> <span class="n">asso</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">asso</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">vcs</span><span class="o">.</span><span class="n">_protected_elements</span><span class="p">[</span>
                            <span class="n">etype</span><span class="p">]:</span>
                        <span class="n">dumpToJson</span><span class="p">(</span>
                            <span class="n">vcs</span><span class="o">.</span><span class="n">elements</span><span class="p">[</span><span class="n">etype</span><span class="p">][</span><span class="n">asso</span><span class="p">],</span>
                            <span class="n">fileout</span><span class="p">,</span>
                            <span class="n">skipped</span><span class="o">=</span><span class="n">skipped</span><span class="p">,</span>
                            <span class="n">must</span><span class="o">=</span><span class="p">[],</span>
                            <span class="n">indent</span><span class="o">=</span><span class="n">indent</span><span class="p">,</span>
                            <span class="n">sort_keys</span><span class="o">=</span><span class="n">sort_keys</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">dic</span><span class="p">,</span> <span class="n">sort_keys</span><span class="o">=</span><span class="n">sort_keys</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="n">indent</span><span class="p">)</span>


<div class="viewcode-block" id="getfontname"><a class="viewcode-back" href="../../vcs/misc/utils.html#vcs.utils.getfontname">[docs]</a><span class="k">def</span> <span class="nf">getfontname</span><span class="p">(</span><span class="n">number</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Retrieve a font name for a given font index.</span>

<span class="sd">    :param number: Index of the font to get the name of.</span>
<span class="sd">    :type number: int</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">number</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">vcs</span><span class="o">.</span><span class="n">elements</span><span class="p">[</span><span class="s2">&quot;fontNumber&quot;</span><span class="p">]:</span>
        <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Error font number not existing </span><span class="si">%i</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">number</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">vcs</span><span class="o">.</span><span class="n">elements</span><span class="p">[</span><span class="s2">&quot;fontNumber&quot;</span><span class="p">][</span><span class="n">number</span><span class="p">]</span></div>


<div class="viewcode-block" id="getfontnumber"><a class="viewcode-back" href="../../vcs/misc/utils.html#vcs.utils.getfontnumber">[docs]</a><span class="k">def</span> <span class="nf">getfontnumber</span><span class="p">(</span><span class="n">name</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Retrieve a font index for a given font name.</span>

<span class="sd">    :param name: Name of the font to get the index of.</span>
<span class="sd">    :type name: str</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">vcs</span><span class="o">.</span><span class="n">elements</span><span class="p">[</span><span class="s2">&quot;fontNumber&quot;</span><span class="p">]:</span>
        <span class="k">if</span> <span class="n">vcs</span><span class="o">.</span><span class="n">elements</span><span class="p">[</span><span class="s2">&quot;fontNumber&quot;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">==</span> <span class="n">name</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">i</span>
    <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Font name not existing! </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">name</span><span class="p">)</span></div>


<span class="k">def</span> <span class="nf">process_src_element</span><span class="p">(</span><span class="n">code</span><span class="p">):</span>
    <span class="n">i</span> <span class="o">=</span> <span class="n">code</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">&quot;_&quot;</span><span class="p">)</span>
    <span class="n">typ</span> <span class="o">=</span> <span class="n">code</span><span class="p">[:</span><span class="n">i</span><span class="p">]</span>
    <span class="n">code</span> <span class="o">=</span> <span class="n">code</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">:]</span>
    <span class="n">i</span> <span class="o">=</span> <span class="n">code</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">&quot;(&quot;</span><span class="p">)</span>
    <span class="n">nm</span> <span class="o">=</span> <span class="n">code</span><span class="p">[:</span><span class="n">i</span><span class="p">]</span>
    <span class="n">code</span> <span class="o">=</span> <span class="n">code</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">typ</span> <span class="o">==</span> <span class="s2">&quot;Gfb&quot;</span><span class="p">:</span>
            <span class="n">boxfill</span><span class="o">.</span><span class="n">process_src</span><span class="p">(</span><span class="n">nm</span><span class="p">,</span> <span class="n">code</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">typ</span> <span class="o">==</span> <span class="s2">&quot;Gfi&quot;</span><span class="p">:</span>
            <span class="n">isofill</span><span class="o">.</span><span class="n">process_src</span><span class="p">(</span><span class="n">nm</span><span class="p">,</span> <span class="n">code</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">typ</span> <span class="o">==</span> <span class="s2">&quot;Gi&quot;</span><span class="p">:</span>
            <span class="n">isoline</span><span class="o">.</span><span class="n">process_src</span><span class="p">(</span><span class="n">nm</span><span class="p">,</span> <span class="n">code</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">typ</span> <span class="o">==</span> <span class="s2">&quot;L&quot;</span><span class="p">:</span>
            <span class="n">dic</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="n">sp</span> <span class="o">=</span> <span class="n">code</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">sp</span><span class="p">),</span> <span class="mi">2</span><span class="p">):</span>
                <span class="n">dic</span><span class="p">[</span><span class="nb">eval</span><span class="p">(</span><span class="n">sp</span><span class="p">[</span><span class="n">i</span><span class="p">])]</span> <span class="o">=</span> <span class="nb">eval</span><span class="p">(</span><span class="n">sp</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">])</span>
            <span class="n">vcs</span><span class="o">.</span><span class="n">elements</span><span class="p">[</span><span class="s2">&quot;list&quot;</span><span class="p">][</span><span class="n">nm</span><span class="p">]</span> <span class="o">=</span> <span class="n">dic</span>
        <span class="k">elif</span> <span class="n">typ</span> <span class="o">==</span> <span class="s2">&quot;Gtd&quot;</span><span class="p">:</span>
            <span class="n">taylor</span><span class="o">.</span><span class="n">process_src</span><span class="p">(</span><span class="n">nm</span><span class="p">,</span> <span class="n">code</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">typ</span> <span class="o">==</span> <span class="s2">&quot;Proj&quot;</span><span class="p">:</span>
            <span class="n">projection</span><span class="o">.</span><span class="n">process_src</span><span class="p">(</span><span class="n">nm</span><span class="p">,</span> <span class="n">code</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">typ</span> <span class="o">==</span> <span class="s2">&quot;Tf&quot;</span><span class="p">:</span>
            <span class="n">fillarea</span><span class="o">.</span><span class="n">process_src</span><span class="p">(</span><span class="n">nm</span><span class="p">,</span> <span class="n">code</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">typ</span> <span class="o">==</span> <span class="s2">&quot;P&quot;</span><span class="p">:</span>
            <span class="n">template</span><span class="o">.</span><span class="n">process_src</span><span class="p">(</span><span class="n">nm</span><span class="p">,</span> <span class="n">code</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">typ</span> <span class="o">==</span> <span class="s2">&quot;Tt&quot;</span><span class="p">:</span>
            <span class="n">texttable</span><span class="o">.</span><span class="n">process_src</span><span class="p">(</span><span class="n">nm</span><span class="p">,</span> <span class="n">code</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">typ</span> <span class="o">==</span> <span class="s2">&quot;To&quot;</span><span class="p">:</span>
            <span class="n">textorientation</span><span class="o">.</span><span class="n">process_src</span><span class="p">(</span><span class="n">nm</span><span class="p">,</span> <span class="n">code</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">typ</span> <span class="o">==</span> <span class="s2">&quot;Tl&quot;</span><span class="p">:</span>
            <span class="n">line</span><span class="o">.</span><span class="n">process_src</span><span class="p">(</span><span class="n">nm</span><span class="p">,</span> <span class="n">code</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">typ</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;GXy&quot;</span><span class="p">,</span> <span class="s2">&quot;GYx&quot;</span><span class="p">,</span> <span class="s2">&quot;GXY&quot;</span><span class="p">,</span> <span class="s2">&quot;GSp&quot;</span><span class="p">]:</span>
            <span class="n">unified1D</span><span class="o">.</span><span class="n">process_src</span><span class="p">(</span><span class="n">nm</span><span class="p">,</span> <span class="n">code</span><span class="p">,</span> <span class="n">typ</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">typ</span> <span class="o">==</span> <span class="s2">&quot;Gv&quot;</span><span class="p">:</span>
            <span class="n">vector</span><span class="o">.</span><span class="n">process_src</span><span class="p">(</span><span class="n">nm</span><span class="p">,</span> <span class="n">code</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">typ</span> <span class="o">==</span> <span class="s2">&quot;Tm&quot;</span><span class="p">:</span>
            <span class="n">marker</span><span class="o">.</span><span class="n">process_src</span><span class="p">(</span><span class="n">nm</span><span class="p">,</span> <span class="n">code</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">typ</span> <span class="o">==</span> <span class="s2">&quot;C&quot;</span><span class="p">:</span>
            <span class="n">colormap</span><span class="o">.</span><span class="n">process_src</span><span class="p">(</span><span class="n">nm</span><span class="p">,</span> <span class="n">code</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
        <span class="nb">print</span> <span class="s2">&quot;Processing error for </span><span class="si">%s</span><span class="s2">,</span><span class="si">%s</span><span class="s2">: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">nm</span><span class="p">,</span> <span class="n">typ</span><span class="p">,</span> <span class="n">err</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">listelements</span><span class="p">(</span><span class="n">typ</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">typ</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">return</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">vcs</span><span class="o">.</span><span class="n">elements</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
    <span class="k">if</span> <span class="n">typ</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;xvsy&quot;</span><span class="p">,</span> <span class="s2">&quot;yxvsx&quot;</span><span class="p">,</span> <span class="s2">&quot;scatter&quot;</span><span class="p">,</span> <span class="s2">&quot;xyvsy&quot;</span><span class="p">):</span>
        <span class="n">names</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">aliased</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;xvsy&quot;</span><span class="p">,</span> <span class="s2">&quot;yxvsx&quot;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">gm</span> <span class="ow">in</span> <span class="n">vcs</span><span class="o">.</span><span class="n">elements</span><span class="p">[</span><span class="s2">&quot;1d&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">gm</span><span class="o">.</span><span class="n">g_type</span> <span class="ow">in</span> <span class="n">aliased</span> <span class="ow">and</span> <span class="n">typ</span> <span class="ow">in</span> <span class="n">aliased</span><span class="p">:</span>
                <span class="n">names</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">gm</span><span class="o">.</span><span class="n">g_type</span> <span class="o">==</span> <span class="n">typ</span><span class="p">:</span>
                <span class="n">names</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
        <span class="k">return</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">names</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">typ</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">vcs</span><span class="o">.</span><span class="n">elements</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
        <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span>
            <span class="s2">&quot;Error: &#39;</span><span class="si">%s</span><span class="s2">&#39; is not a valid vcs element</span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="s2">&quot;Valid vcs elements are: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span>
            <span class="p">(</span><span class="n">typ</span><span class="p">,</span> <span class="n">vcs</span><span class="o">.</span><span class="n">elements</span><span class="o">.</span><span class="n">keys</span><span class="p">()))</span>
    <span class="k">return</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">vcs</span><span class="o">.</span><span class="n">elements</span><span class="p">[</span><span class="n">typ</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>


<span class="c1">#</span>
<span class="c1">#</span>
<span class="c1"># Show VCS primary and secondary elements wrapper for VCS.                  #</span>
<span class="c1">#</span>
<span class="c1">#</span>
<div class="viewcode-block" id="show"><a class="viewcode-back" href="../../vcs/misc/utils.html#vcs.utils.show">[docs]</a><span class="k">def</span> <span class="nf">show</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Show the list of VCS primary and secondary class objects.</span>

<span class="sd">    :Example:</span>

<span class="sd">        .. doctest:: utils_show</span>

<span class="sd">            &gt;&gt;&gt; a=vcs.init() # Create a VCS Canvas instance, named &#39;a&#39;</span>
<span class="sd">            &gt;&gt;&gt; a.show(&#39;boxfill&#39;) # List boxfill objects on Canvas &#39;a&#39;</span>
<span class="sd">            &gt;&gt;&gt; a.show(&#39;isofill&#39;) # List isofill objects on Canvas &#39;a&#39;</span>
<span class="sd">            &gt;&gt;&gt; a.show(&#39;line&#39;) # List line objects on Canvas &#39;a&#39;</span>
<span class="sd">            &gt;&gt;&gt; a.show(&#39;marker&#39;) # List marker objects on Canvas &#39;a&#39;</span>
<span class="sd">            &gt;&gt;&gt; a.show(&#39;text&#39;) # List text objects on Canvas &#39;a&#39;</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">args</span> <span class="o">==</span> <span class="p">():</span>
        <span class="k">return</span> <span class="n">vcs</span><span class="o">.</span><span class="n">listelements</span><span class="p">()</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">elts</span> <span class="o">=</span> <span class="n">vcs</span><span class="o">.</span><span class="n">listelements</span><span class="p">(</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">m</span> <span class="o">=</span> <span class="nb">max</span><span class="p">([</span><span class="nb">len</span><span class="p">(</span><span class="n">e</span><span class="p">)</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">elts</span><span class="p">])</span> <span class="o">+</span> <span class="mi">1</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="n">m</span> <span class="o">=</span> <span class="mi">4</span>
        <span class="nb">print</span> <span class="s2">&quot;*******************</span><span class="si">%s</span><span class="s2"> Names List**********************&quot;</span> <span class="o">%</span> <span class="p">(</span>
            <span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">capitalize</span><span class="p">())</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">e</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">elts</span><span class="p">):</span>
            <span class="nb">print</span> <span class="p">(</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">e</span><span class="p">)</span><span class="o">.</span><span class="n">ljust</span><span class="p">(</span><span class="n">m</span><span class="p">),</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">%</span> <span class="mi">3</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="nb">print</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">elts</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">%</span> <span class="mi">3</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="nb">print</span>
        <span class="nb">print</span> <span class="s2">&quot;*******************End </span><span class="si">%s</span><span class="s2"> Names List**********************&quot;</span> <span class="o">%</span> <span class="p">(</span>
            <span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">capitalize</span><span class="p">())</span>
        <span class="k">return</span></div>


<span class="k">def</span> <span class="nf">_scriptrun</span><span class="p">(</span><span class="n">script</span><span class="p">,</span> <span class="n">canvas</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="c1"># Now does the python Graphic methods</span>
    <span class="n">f</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">script</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span>
    <span class="c1"># browse through the file to look for taylordiagram/python graphics methods</span>
    <span class="n">processing</span> <span class="o">=</span> <span class="kc">False</span>  <span class="c1"># found a taylor graphic method</span>
    <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="n">f</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">l</span><span class="p">[:</span><span class="mi">6</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;color(&quot;</span> <span class="ow">and</span> <span class="n">canvas</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">canvas</span><span class="o">.</span><span class="n">setcolormap</span><span class="p">(</span><span class="n">l</span><span class="o">.</span><span class="n">strip</span><span class="p">()[</span><span class="mi">6</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
        <span class="k">elif</span> <span class="n">l</span><span class="p">[:</span><span class="mi">2</span><span class="p">]</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;P_&quot;</span><span class="p">,</span> <span class="s2">&quot;L_&quot;</span><span class="p">,</span> <span class="s2">&quot;C_&quot;</span><span class="p">]</span> <span class="ow">or</span> \
                <span class="n">l</span><span class="p">[:</span><span class="mi">3</span><span class="p">]</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;Tm_&quot;</span><span class="p">,</span> <span class="s2">&quot;Gv_&quot;</span><span class="p">,</span> <span class="s2">&quot;Gi_&quot;</span><span class="p">,</span> <span class="s2">&quot;Tl_&quot;</span><span class="p">,</span> <span class="s2">&quot;To_&quot;</span><span class="p">,</span> <span class="s2">&quot;Tt_&quot;</span><span class="p">,</span> <span class="s2">&quot;Tf_&quot;</span><span class="p">,</span> <span class="p">]</span> <span class="ow">or</span>\
                <span class="n">l</span><span class="p">[:</span><span class="mi">4</span><span class="p">]</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;GXy_&#39;</span><span class="p">,</span> <span class="s1">&#39;GYx_&#39;</span><span class="p">,</span> <span class="s1">&#39;GXY_&#39;</span><span class="p">,</span> <span class="s1">&#39;GSp_&#39;</span><span class="p">,</span>
                          <span class="s1">&#39;Gtd_&#39;</span><span class="p">,</span> <span class="s1">&#39;Gfb_&#39;</span><span class="p">,</span> <span class="s2">&quot;Gfm_&quot;</span><span class="p">,</span> <span class="s2">&quot;Gfi_&quot;</span><span class="p">]</span> <span class="ow">or</span> \
                <span class="n">l</span><span class="p">[:</span><span class="mi">5</span><span class="p">]</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;Proj_&quot;</span><span class="p">,</span> <span class="p">]:</span>
            <span class="c1"># We found a graphic method</span>
            <span class="n">processing</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="n">opened</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="n">closed</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="n">s</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        <span class="k">if</span> <span class="n">processing</span><span class="p">:</span>
            <span class="n">s</span> <span class="o">+=</span> <span class="n">l</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
            <span class="n">opened</span> <span class="o">+=</span> <span class="n">l</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="s2">&quot;(&quot;</span><span class="p">)</span>
            <span class="n">closed</span> <span class="o">+=</span> <span class="n">l</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="s2">&quot;)&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">closed</span> <span class="o">==</span> <span class="n">opened</span><span class="p">:</span>
                <span class="c1"># ok we read the whole Graphic method</span>
                <span class="n">vcs</span><span class="o">.</span><span class="n">process_src_element</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
                <span class="n">processing</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
    <span class="c1"># Ok now we need to double check the isolines</span>
    <span class="n">gd</span> <span class="o">=</span> <span class="n">vcs</span><span class="o">.</span><span class="n">elements</span><span class="p">[</span><span class="s2">&quot;isoline&quot;</span><span class="p">][</span><span class="s2">&quot;default&quot;</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">g</span> <span class="ow">in</span> <span class="n">vcs</span><span class="o">.</span><span class="n">elements</span><span class="p">[</span><span class="s2">&quot;isoline&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
        <span class="k">if</span> <span class="n">g</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;default&quot;</span><span class="p">:</span>
            <span class="k">continue</span>
        <span class="k">for</span> <span class="n">att</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;line&quot;</span><span class="p">,</span> <span class="s2">&quot;textcolors&quot;</span><span class="p">,</span> <span class="s2">&quot;text&quot;</span><span class="p">]:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="nb">setattr</span><span class="p">(</span><span class="n">g</span><span class="p">,</span> <span class="n">att</span><span class="p">,</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">g</span><span class="p">,</span> <span class="n">att</span><span class="p">))</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="n">lst</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="k">if</span> <span class="n">att</span> <span class="o">==</span> <span class="s2">&quot;line&quot;</span><span class="p">:</span>
                    <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">g</span><span class="o">.</span><span class="n">line</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">vcs</span><span class="o">.</span><span class="n">elements</span><span class="p">[</span><span class="s2">&quot;line&quot;</span><span class="p">]:</span>
                            <span class="n">lst</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">vcs</span><span class="o">.</span><span class="n">elements</span><span class="p">[</span><span class="s2">&quot;line&quot;</span><span class="p">][</span><span class="n">e</span><span class="p">])</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="n">lst</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
                <span class="k">elif</span> <span class="n">att</span> <span class="o">==</span> <span class="s2">&quot;text&quot;</span><span class="p">:</span>
                    <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">g</span><span class="o">.</span><span class="n">line</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">vcs</span><span class="o">.</span><span class="n">elements</span><span class="p">[</span><span class="s2">&quot;textorientation&quot;</span><span class="p">]:</span>
                            <span class="n">lst</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">vcs</span><span class="o">.</span><span class="n">elements</span><span class="p">[</span><span class="s2">&quot;line&quot;</span><span class="p">][</span><span class="n">e</span><span class="p">])</span>
                        <span class="k">elif</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">vcs</span><span class="o">.</span><span class="n">elements</span><span class="p">[</span><span class="s2">&quot;textcombined&quot;</span><span class="p">]:</span>
                            <span class="n">lst</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">vcs</span><span class="o">.</span><span class="n">elements</span><span class="p">[</span><span class="s2">&quot;line&quot;</span><span class="p">][</span><span class="n">e</span><span class="p">])</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="n">lst</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
                <span class="k">elif</span> <span class="n">att</span> <span class="o">==</span> <span class="s2">&quot;textcolors&quot;</span><span class="p">:</span>
                    <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">g</span><span class="o">.</span><span class="n">line</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">vcs</span><span class="o">.</span><span class="n">elements</span><span class="p">[</span><span class="s2">&quot;texttable&quot;</span><span class="p">]:</span>
                            <span class="n">lst</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">vcs</span><span class="o">.</span><span class="n">elements</span><span class="p">[</span><span class="s2">&quot;line&quot;</span><span class="p">][</span><span class="n">e</span><span class="p">])</span>
                        <span class="k">elif</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">vcs</span><span class="o">.</span><span class="n">elements</span><span class="p">[</span><span class="s2">&quot;textcombined&quot;</span><span class="p">]:</span>
                            <span class="n">lst</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">vcs</span><span class="o">.</span><span class="n">elements</span><span class="p">[</span><span class="s2">&quot;line&quot;</span><span class="p">][</span><span class="n">e</span><span class="p">])</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="n">lst</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="nb">setattr</span><span class="p">(</span><span class="n">g</span><span class="p">,</span> <span class="n">att</span><span class="p">,</span> <span class="n">lst</span><span class="p">)</span>
                <span class="k">except</span><span class="p">:</span>
                    <span class="nb">setattr</span><span class="p">(</span><span class="n">g</span><span class="p">,</span> <span class="n">att</span><span class="p">,</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">gd</span><span class="p">,</span> <span class="n">att</span><span class="p">))</span>

<span class="c1">#</span>
<span class="c1">#</span>
<span class="c1"># Import old VCS file script commands into CDAT.                            #</span>
<span class="c1">#</span>
<span class="c1">#</span>


<span class="k">def</span> <span class="nf">scriptrun_scr</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">):</span>
    <span class="kn">import</span> <span class="nn">__main__</span>

    <span class="c1"># Open VCS script file for reading and read all lines into a Python list</span>
    <span class="n">fin</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span>
    <span class="n">l</span> <span class="o">=</span> <span class="n">fin</span><span class="o">.</span><span class="n">readlines</span><span class="p">()</span>
    <span class="n">line_ct</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">l</span><span class="p">)</span>
    <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="c1"># Check to see if it is a VCS generated Python script file.</span>
    <span class="c1"># If it is, then simply</span>
    <span class="c1"># call the execfile function to execute the script and close the file.</span>
    <span class="k">if</span> <span class="p">((</span><span class="n">l</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">:</span><span class="mi">37</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;#####################################&quot;</span><span class="p">)</span> <span class="ow">and</span>
            <span class="p">(</span><span class="n">l</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">:</span><span class="mi">35</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;#                                 #&quot;</span><span class="p">)</span> <span class="ow">and</span>
            <span class="p">(</span><span class="n">l</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="mi">0</span><span class="p">:</span><span class="mi">33</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;# Import and Initialize VCS     #&quot;</span><span class="p">)</span> <span class="ow">and</span>
            <span class="p">(</span><span class="n">l</span><span class="p">[</span><span class="mi">3</span><span class="p">][</span><span class="mi">0</span><span class="p">:</span><span class="mi">31</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;#                             #&quot;</span><span class="p">)</span> <span class="ow">and</span>
            <span class="p">(</span><span class="n">l</span><span class="p">[</span><span class="mi">4</span><span class="p">][</span><span class="mi">0</span><span class="p">:</span><span class="mi">29</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;#############################&quot;</span><span class="p">)):</span>
        <span class="n">fin</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="n">exec</span><span class="p">(</span><span class="nb">compile</span><span class="p">(</span><span class="nb">open</span><span class="p">(</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">.</span><span class="n">read</span><span class="p">(),</span> <span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="s1">&#39;exec&#39;</span><span class="p">),</span> <span class="n">__main__</span><span class="o">.</span><span class="n">__dict__</span><span class="p">)</span>
        <span class="k">return</span>

    <span class="k">while</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">line_ct</span><span class="p">:</span>
        <span class="c1"># Loop through all lines and determine when a VCS command line</span>
        <span class="c1"># begins and ends. That is, get only one VCS command at a time</span>
        <span class="n">scr_str</span> <span class="o">=</span> <span class="n">l</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
        <span class="n">lt_paren_ct</span> <span class="o">=</span> <span class="n">l</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="s1">&#39;(&#39;</span><span class="p">)</span>
        <span class="n">rt_paren_ct</span> <span class="o">=</span> <span class="n">l</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="s1">&#39;)&#39;</span><span class="p">)</span>
        <span class="k">while</span> <span class="n">lt_paren_ct</span> <span class="o">&gt;</span> <span class="n">rt_paren_ct</span><span class="p">:</span>
            <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="n">scr_str</span> <span class="o">+=</span> <span class="n">l</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
            <span class="n">lt_paren_ct</span> <span class="o">+=</span> <span class="n">l</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="s1">&#39;(&#39;</span><span class="p">)</span>
            <span class="n">rt_paren_ct</span> <span class="o">+=</span> <span class="n">l</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="s1">&#39;)&#39;</span><span class="p">)</span>
        <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="n">scr_str</span> <span class="o">=</span> <span class="n">scr_str</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>

        <span class="c1"># Get the VCS command</span>
        <span class="n">vcs_cmd</span> <span class="o">=</span> <span class="n">scr_str</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;(&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>

        <span class="n">function</span> <span class="o">=</span> <span class="n">source</span> <span class="o">=</span> <span class="n">name</span> <span class="o">=</span> <span class="n">units</span> <span class="o">=</span> <span class="n">title</span> <span class="o">=</span> <span class="n">lon_name</span> <span class="o">=</span> <span class="n">lat_name</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
        <span class="n">comment1</span> <span class="o">=</span> <span class="n">comment2</span> <span class="o">=</span> <span class="n">comment3</span> <span class="o">=</span> <span class="n">comment4</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
        <span class="k">if</span> <span class="n">vcs_cmd</span> <span class="o">==</span> <span class="s1">&#39;A&#39;</span><span class="p">:</span>
            <span class="c1"># Get the data via CDMS. That is, retrieve that data as a</span>
            <span class="c1"># _TransientVariable. But first, get the source, name, title,</span>
            <span class="c1"># etc. of the file.</span>
            <span class="n">slab_name</span> <span class="o">=</span> <span class="n">scr_str</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;(&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">][</span><span class="mi">2</span><span class="p">:]</span>
            <span class="n">a</span> <span class="o">=</span> <span class="n">scr_str</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;&quot;,&#39;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">a</span><span class="p">)):</span>
                <span class="n">b</span> <span class="o">=</span> <span class="n">a</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;=&quot;&#39;</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">b</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="o">-</span><span class="mi">4</span><span class="p">:]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;file&#39;</span><span class="p">:</span>
                    <span class="c1"># Open CDMS file</span>
                    <span class="n">fcdms</span> <span class="o">=</span> <span class="n">cdms2</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">b</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
                <span class="k">elif</span> <span class="n">b</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="o">-</span><span class="mi">8</span><span class="p">:]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;function&#39;</span><span class="p">:</span>
                    <span class="n">function</span> <span class="o">=</span> <span class="n">b</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>                              <span class="c1"># Get function</span>
                <span class="k">elif</span> <span class="n">b</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;source&#39;</span><span class="p">:</span>
                    <span class="n">source</span> <span class="o">=</span> <span class="n">b</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
                <span class="k">elif</span> <span class="p">((</span><span class="n">b</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="o">-</span><span class="mi">4</span><span class="p">:]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;name&#39;</span><span class="p">)</span> <span class="ow">and</span>
                      <span class="p">(</span><span class="n">b</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="o">-</span><span class="mi">5</span><span class="p">:]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">!=</span> <span class="s1">&#39;xname&#39;</span><span class="p">)</span> <span class="ow">and</span>
                      <span class="p">(</span><span class="n">b</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="o">-</span><span class="mi">5</span><span class="p">:]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">!=</span> <span class="s1">&#39;yname&#39;</span><span class="p">)):</span>
                    <span class="n">name</span> <span class="o">=</span> <span class="n">b</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;&quot;)&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
                <span class="k">elif</span> <span class="n">b</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;units&#39;</span><span class="p">:</span>
                    <span class="n">units</span> <span class="o">=</span> <span class="n">b</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;&quot;)&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
                <span class="k">elif</span> <span class="n">b</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="o">-</span><span class="mi">5</span><span class="p">:]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;title&#39;</span><span class="p">:</span>
                    <span class="n">title</span> <span class="o">=</span> <span class="n">b</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;&quot;)&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
                <span class="k">elif</span> <span class="n">b</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="o">-</span><span class="mi">5</span><span class="p">:]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;xname&#39;</span><span class="p">:</span>
                    <span class="n">lon_name</span> <span class="o">=</span> <span class="n">b</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;&quot;)&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
                <span class="k">elif</span> <span class="n">b</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="o">-</span><span class="mi">5</span><span class="p">:]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;yname&#39;</span><span class="p">:</span>
                    <span class="n">lat_name</span> <span class="o">=</span> <span class="n">b</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;&quot;)&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
                <span class="k">elif</span> <span class="n">b</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="o">-</span><span class="mi">9</span><span class="p">:]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;comment#1&#39;</span><span class="p">:</span>
                    <span class="n">comment1</span> <span class="o">=</span> <span class="n">b</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
                <span class="k">elif</span> <span class="n">b</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="o">-</span><span class="mi">9</span><span class="p">:]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;comment#2&#39;</span><span class="p">:</span>
                    <span class="n">comment2</span> <span class="o">=</span> <span class="n">b</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
                <span class="k">elif</span> <span class="n">b</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="o">-</span><span class="mi">9</span><span class="p">:]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;comment#3&#39;</span><span class="p">:</span>
                    <span class="n">comment3</span> <span class="o">=</span> <span class="n">b</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
                <span class="k">elif</span> <span class="n">b</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="o">-</span><span class="mi">9</span><span class="p">:]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;comment#4&#39;</span><span class="p">:</span>
                    <span class="n">comment4</span> <span class="o">=</span> <span class="n">b</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">function</span> <span class="o">!=</span> <span class="s1">&#39;&#39;</span><span class="p">:</span>
                <span class="n">b</span> <span class="o">=</span> <span class="n">function</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;(&#39;</span><span class="p">)</span>
                <span class="n">V</span> <span class="o">=</span> <span class="n">b</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">__main__</span><span class="o">.</span><span class="n">__dict__</span><span class="p">[</span><span class="n">slab_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">__main__</span><span class="o">.</span><span class="n">__dict__</span><span class="p">[</span><span class="n">V</span><span class="p">]</span> <span class="o">*</span> <span class="mf">1000.</span>
                <span class="k">continue</span>

            <span class="n">a</span> <span class="o">=</span> <span class="n">scr_str</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">)</span>

            <span class="c1"># Now get the coordinate values</span>
            <span class="n">x1</span> <span class="o">=</span> <span class="n">x2</span> <span class="o">=</span> <span class="n">y1</span> <span class="o">=</span> <span class="n">y2</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">a</span><span class="p">)):</span>
                <span class="n">c</span> <span class="o">=</span> <span class="n">a</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">b</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;=&#39;</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">b</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;xfirst&#39;</span><span class="p">:</span>
                    <span class="n">x1</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">b</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;)&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span>
                <span class="k">elif</span> <span class="n">b</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;xlast&#39;</span><span class="p">:</span>
                    <span class="n">x2</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">b</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;)&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span>
                <span class="k">elif</span> <span class="n">b</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="o">-</span><span class="mi">6</span><span class="p">:]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;yfirst&#39;</span><span class="p">:</span>
                    <span class="n">y1</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">b</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;)&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span>
                <span class="k">elif</span> <span class="n">b</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;ylast&#39;</span><span class="p">:</span>
                    <span class="n">y2</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">b</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;)&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span>

            <span class="c1"># Get the variable from the CDMS opened file</span>
            <span class="n">V</span> <span class="o">=</span> <span class="n">fcdms</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="n">name</span><span class="p">]</span>

            <span class="c1"># Check for the order of the variable and re-order dimensions</span>
            <span class="c1"># if necessary</span>
            <span class="n">Order</span> <span class="o">=</span> <span class="s1">&#39;(</span><span class="si">%s</span><span class="s1">)(</span><span class="si">%s</span><span class="s1">)&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">lat_name</span><span class="p">,</span> <span class="n">lon_name</span><span class="p">)</span>
            <span class="n">Order</span> <span class="o">=</span> <span class="n">Order</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;()&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">Order</span> <span class="o">==</span> <span class="s1">&#39;&#39;</span><span class="p">:</span>
                <span class="n">Order</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="n">axis_ids</span> <span class="o">=</span> <span class="n">V</span><span class="o">.</span><span class="n">getAxisIds</span><span class="p">()</span>
            <span class="n">re_order_dimension</span> <span class="o">=</span> <span class="s1">&#39;no&#39;</span>
            <span class="k">try</span><span class="p">:</span>                 <span class="c1"># only re-order on two or more dimensions</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">axis_ids</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">!=</span> <span class="n">lon_name</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">axis_ids</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span> <span class="o">!=</span> <span class="n">lat_name</span><span class="p">):</span>
                    <span class="n">re_order_dimension</span> <span class="o">=</span> <span class="s1">&#39;yes&#39;</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="k">pass</span>

            <span class="c1"># Must have the remaining dimension names in the Order list</span>
            <span class="k">if</span> <span class="n">Order</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">O_ct</span> <span class="o">=</span> <span class="n">Order</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="s1">&#39;(&#39;</span><span class="p">)</span>
                <span class="n">V_ct</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">V</span><span class="o">.</span><span class="n">getAxisIds</span><span class="p">())</span>
                <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">O_ct</span><span class="p">,</span> <span class="n">V_ct</span><span class="p">):</span>
                    <span class="n">Order</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;(</span><span class="si">%s</span><span class="s1">)&#39;</span> <span class="o">%</span> <span class="n">axis_ids</span><span class="p">[</span><span class="n">V_ct</span> <span class="o">-</span> <span class="n">j</span> <span class="o">-</span> <span class="mi">1</span><span class="p">])</span> <span class="o">+</span> <span class="n">Order</span>

            <span class="c1"># Set the data dictionary up to retrieve the dat from CDMS</span>
            <span class="k">if</span> <span class="n">re_order_dimension</span> <span class="o">==</span> <span class="s1">&#39;no&#39;</span><span class="p">:</span>
                <span class="k">if</span> <span class="p">((</span><span class="n">x1</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">x2</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">and</span>
                        <span class="p">(</span><span class="n">y1</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">y2</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)):</span>
                    <span class="n">data_dict</span> <span class="o">=</span> <span class="p">{</span>
                        <span class="n">lon_name</span><span class="p">:</span> <span class="p">(</span>
                            <span class="n">x1</span><span class="p">,</span> <span class="n">x2</span><span class="p">),</span> <span class="n">lat_name</span><span class="p">:</span> <span class="p">(</span>
                            <span class="n">y1</span><span class="p">,</span> <span class="n">y2</span><span class="p">),</span> <span class="s1">&#39;order&#39;</span><span class="p">:</span> <span class="n">Order</span><span class="p">}</span>
                <span class="k">elif</span> <span class="p">((</span><span class="n">x1</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">x2</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">and</span>
                      <span class="p">(</span><span class="n">y1</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">y2</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)):</span>
                    <span class="n">data_dict</span> <span class="o">=</span> <span class="p">{</span><span class="n">lon_name</span><span class="p">:</span> <span class="p">(</span><span class="n">x1</span><span class="p">,</span> <span class="n">x2</span><span class="p">),</span> <span class="s1">&#39;order&#39;</span><span class="p">:</span> <span class="n">Order</span><span class="p">}</span>
                <span class="k">elif</span> <span class="p">((</span><span class="n">x1</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">x2</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">and</span>
                      <span class="p">(</span><span class="n">y1</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">y2</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)):</span>
                    <span class="n">data_dict</span> <span class="o">=</span> <span class="p">{</span><span class="n">lat_name</span><span class="p">:</span> <span class="p">(</span><span class="n">y1</span><span class="p">,</span> <span class="n">y2</span><span class="p">),</span> <span class="s1">&#39;order&#39;</span><span class="p">:</span> <span class="n">Order</span><span class="p">}</span>
                <span class="k">elif</span> <span class="p">((</span><span class="n">x1</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">x2</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">and</span>
                      <span class="p">(</span><span class="n">y1</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">y2</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)):</span>
                    <span class="n">data_dict</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="p">((</span><span class="n">x1</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">x2</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">and</span>
                        <span class="p">(</span><span class="n">y1</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">y2</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)):</span>
                    <span class="n">data_dict</span> <span class="o">=</span> <span class="p">{</span>
                        <span class="n">lat_name</span><span class="p">:</span> <span class="p">(</span>
                            <span class="n">x1</span><span class="p">,</span> <span class="n">x2</span><span class="p">),</span> <span class="n">lon_name</span><span class="p">:</span> <span class="p">(</span>
                            <span class="n">y1</span><span class="p">,</span> <span class="n">y2</span><span class="p">),</span> <span class="s1">&#39;order&#39;</span><span class="p">:</span> <span class="n">Order</span><span class="p">}</span>
                <span class="k">elif</span> <span class="p">((</span><span class="n">x1</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">x2</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">and</span>
                      <span class="p">(</span><span class="n">y1</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">y2</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)):</span>
                    <span class="n">data_dict</span> <span class="o">=</span> <span class="p">{</span><span class="n">lon_name</span><span class="p">:</span> <span class="p">(</span><span class="n">x1</span><span class="p">,</span> <span class="n">x2</span><span class="p">),</span> <span class="s1">&#39;order&#39;</span><span class="p">:</span> <span class="n">Order</span><span class="p">}</span>
                <span class="k">elif</span> <span class="p">((</span><span class="n">x1</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">x2</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">and</span>
                      <span class="p">(</span><span class="n">y1</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">y2</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)):</span>
                    <span class="n">data_dict</span> <span class="o">=</span> <span class="p">{</span><span class="n">lat_name</span><span class="p">:</span> <span class="p">(</span><span class="n">y1</span><span class="p">,</span> <span class="n">y2</span><span class="p">),</span> <span class="s1">&#39;order&#39;</span><span class="p">:</span> <span class="n">Order</span><span class="p">}</span>
                <span class="k">elif</span> <span class="p">((</span><span class="n">x1</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">x2</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">and</span>
                      <span class="p">(</span><span class="n">y1</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">y2</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)):</span>
                    <span class="n">data_dict</span> <span class="o">=</span> <span class="p">{}</span>

            <span class="c1"># Now store the _TransientVariable in the main dictionary for use</span>
            <span class="c1"># later</span>
            <span class="n">V</span><span class="o">.</span><span class="n">units</span> <span class="o">=</span> <span class="n">units</span>
            <span class="n">V</span><span class="o">.</span><span class="n">source</span> <span class="o">=</span> <span class="n">source</span>
            <span class="n">V</span><span class="o">.</span><span class="n">title</span> <span class="o">=</span> <span class="n">title</span>
            <span class="n">V</span><span class="o">.</span><span class="n">comment1</span> <span class="o">=</span> <span class="n">comment1</span>
            <span class="n">V</span><span class="o">.</span><span class="n">comment2</span> <span class="o">=</span> <span class="n">comment2</span>
            <span class="n">V</span><span class="o">.</span><span class="n">comment3</span> <span class="o">=</span> <span class="n">comment3</span>
            <span class="n">V</span><span class="o">.</span><span class="n">comment4</span> <span class="o">=</span> <span class="n">comment4</span>
            <span class="n">__main__</span><span class="o">.</span><span class="n">__dict__</span><span class="p">[</span><span class="n">slab_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">V</span><span class="p">(</span><span class="o">*</span><span class="p">(),</span> <span class="o">**</span><span class="n">data_dict</span><span class="p">)</span>

            <span class="n">fcdms</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>                                     <span class="c1"># Close CDMS file</span>
        <span class="k">elif</span> <span class="n">vcs_cmd</span> <span class="o">==</span> <span class="s1">&#39;D&#39;</span><span class="p">:</span>
            <span class="c1"># plot the data with the appropriate graphics method and template</span>
            <span class="n">a</span> <span class="o">=</span> <span class="n">scr_str</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">)</span>
            <span class="n">a_name</span> <span class="o">=</span> <span class="n">b_name</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">a</span><span class="p">)):</span>
                <span class="n">b</span> <span class="o">=</span> <span class="n">a</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;=&#39;</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">b</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="o">-</span><span class="mi">3</span><span class="p">:]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;off&#39;</span><span class="p">:</span>
                    <span class="k">continue</span>
                <span class="k">elif</span> <span class="n">b</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;priority&#39;</span><span class="p">:</span>
                    <span class="k">continue</span>
                <span class="k">elif</span> <span class="n">b</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;type&#39;</span><span class="p">:</span>
                    <span class="n">graphics_type</span> <span class="o">=</span> <span class="n">b</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
                <span class="k">elif</span> <span class="n">b</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;template&#39;</span><span class="p">:</span>
                    <span class="n">template</span> <span class="o">=</span> <span class="n">b</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
                <span class="k">elif</span> <span class="n">b</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;graph&#39;</span><span class="p">:</span>
                    <span class="n">graphics_name</span> <span class="o">=</span> <span class="n">b</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
                <span class="k">elif</span> <span class="n">b</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;a&#39;</span><span class="p">:</span>
                    <span class="n">a_name</span> <span class="o">=</span> <span class="n">b</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;)&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
                <span class="k">elif</span> <span class="n">b</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;b&#39;</span><span class="p">:</span>
                    <span class="n">b_name</span> <span class="o">=</span> <span class="n">b</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;)&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>

            <span class="n">arglist</span> <span class="o">=</span> <span class="p">[]</span>

            <span class="k">if</span> <span class="n">a_name</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">arglist</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">__main__</span><span class="o">.</span><span class="n">__dict__</span><span class="p">[</span><span class="n">a_name</span><span class="p">])</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">arglist</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">b_name</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">arglist</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">__main__</span><span class="o">.</span><span class="n">__dict__</span><span class="p">[</span><span class="n">b_name</span><span class="p">])</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">arglist</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>
            <span class="n">arglist</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">template</span><span class="p">)</span>
            <span class="n">arglist</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">graphics_type</span><span class="p">)</span>
            <span class="n">arglist</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">graphics_name</span><span class="p">)</span>

            <span class="k">if</span> <span class="p">(</span><span class="n">a_name</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">graphics_type</span> <span class="o">!=</span> <span class="s1">&#39;continents&#39;</span><span class="p">):</span>
                <span class="n">CANVAS</span> <span class="o">=</span> <span class="n">vcs</span><span class="o">.</span><span class="n">init</span><span class="p">()</span>
                <span class="n">CANVAS</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="o">*</span><span class="n">arglist</span><span class="p">,</span> <span class="n">bg</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

        <span class="k">elif</span> <span class="n">vcs_cmd</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;canvas&#39;</span><span class="p">:</span>
            <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s2">&quot;Please implement vcs &#39;canvas&#39; function&quot;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">vcs_cmd</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;page&#39;</span><span class="p">:</span>
            <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s2">&quot;Please implement vcs &#39;page&#39; function&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>  <span class="c1"># Send command to VCS interpreter</span>
            <span class="k">if</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">scr_str</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">scr_str</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="s1">&#39;#&#39;</span><span class="p">):</span>
                <span class="c1"># Save command to a temporary file first,</span>
                <span class="c1"># then read script command</span>
                <span class="c1"># This is the best solution. Avoids rewriting C code that I</span>
                <span class="c1"># know works!</span>
                <span class="n">temporary_file_name</span> <span class="o">=</span> <span class="n">tempfile</span><span class="o">.</span><span class="n">mktemp</span><span class="p">(</span><span class="s1">&#39;.scr&#39;</span><span class="p">)</span>
                <span class="n">fout</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">temporary_file_name</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span>
                <span class="n">fout</span><span class="o">.</span><span class="n">writelines</span><span class="p">(</span><span class="n">scr_str</span><span class="p">)</span>
                <span class="n">fout</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
                <span class="n">_scriptrun</span><span class="p">(</span><span class="n">temporary_file_name</span><span class="p">)</span>
                <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">temporary_file_name</span><span class="p">)</span>
    <span class="n">fin</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>


<span class="k">def</span> <span class="nf">saveinitialfile</span><span class="p">():</span>
    <span class="n">_dotdir</span><span class="p">,</span> <span class="n">_dotdirenv</span> <span class="o">=</span> <span class="n">vcs</span><span class="o">.</span><span class="n">getdotdirectory</span><span class="p">()</span>
    <span class="n">fnm</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">expanduser</span><span class="p">(</span><span class="s2">&quot;~&quot;</span><span class="p">),</span> <span class="n">_dotdir</span><span class="p">,</span> <span class="s1">&#39;initial.attributes&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">fnm</span><span class="p">):</span>
        <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">fnm</span><span class="p">)</span>
    <span class="n">Skip</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">vcs</span><span class="o">.</span><span class="n">elements</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
        <span class="n">Skip</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">vcs</span><span class="o">.</span><span class="n">elements</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">vcs</span><span class="o">.</span><span class="n">_protected_elements</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="ow">or</span> <span class="n">e</span><span class="p">[</span>
                    <span class="p">:</span><span class="mi">2</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;__&quot;</span><span class="p">:</span>  <span class="c1"># temporary elt</span>
                <span class="n">Skip</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">vcs</span><span class="o">.</span><span class="n">elements</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
        <span class="k">if</span> <span class="n">k</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;display&quot;</span><span class="p">,</span> <span class="s2">&quot;font&quot;</span><span class="p">,</span> <span class="s2">&quot;fontNumber&quot;</span><span class="p">]:</span>
            <span class="k">continue</span>
        <span class="k">elif</span> <span class="n">k</span> <span class="o">==</span> <span class="s2">&quot;list&quot;</span><span class="p">:</span>
            <span class="n">D2</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="n">D2</span><span class="p">[</span><span class="s2">&quot;L&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="n">vcs</span><span class="o">.</span><span class="n">elements</span><span class="p">[</span><span class="s2">&quot;list&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="k">if</span> <span class="n">l</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">Skip</span><span class="p">[</span><span class="s2">&quot;list&quot;</span><span class="p">]:</span>
                    <span class="n">D2</span><span class="p">[</span><span class="s2">&quot;L&quot;</span><span class="p">][</span><span class="n">l</span><span class="p">]</span> <span class="o">=</span> <span class="n">vcs</span><span class="o">.</span><span class="n">elements</span><span class="p">[</span><span class="s2">&quot;list&quot;</span><span class="p">][</span><span class="n">l</span><span class="p">]</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">D2</span><span class="p">[</span><span class="s2">&quot;L&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">f</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">fnm</span> <span class="o">+</span> <span class="s2">&quot;.json&quot;</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span>
                <span class="n">json</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">D2</span><span class="p">,</span> <span class="n">f</span><span class="p">)</span>
                <span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
            <span class="k">continue</span>
        <span class="n">e</span> <span class="o">=</span> <span class="n">vcs</span><span class="o">.</span><span class="n">elements</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">nm</span><span class="p">,</span> <span class="n">g</span> <span class="ow">in</span> <span class="n">e</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">nm</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">Skip</span><span class="p">[</span><span class="n">k</span><span class="p">]:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">g</span><span class="o">.</span><span class="n">script</span><span class="p">(</span><span class="n">fnm</span><span class="p">)</span>
                <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
                    <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
                        <span class="s2">&quot;Could not save graphic method </span><span class="si">%s</span><span class="s2"> named </span><span class="si">%s</span><span class="s2">: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span>
                        <span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">nm</span><span class="p">,</span> <span class="n">err</span><span class="p">))</span>
    <span class="c1"># extension .json has been auto-added, removing it in this specific case</span>
    <span class="n">os</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">fnm</span> <span class="o">+</span> <span class="s2">&quot;.json&quot;</span><span class="p">,</span> <span class="n">fnm</span><span class="p">)</span>

<span class="c1">#</span>
<span class="c1">#</span>
<span class="c1"># Import old VCS file script commands into CDAT.</span>
<span class="c1">#</span>
<span class="c1">#</span>


<span class="k">def</span> <span class="nf">scriptrun</span><span class="p">(</span><span class="n">script</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">script</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;scr&quot;</span><span class="p">:</span>
        <span class="n">scriptrun_scr</span><span class="p">(</span><span class="n">script</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">script</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;py&quot;</span><span class="p">:</span>
        <span class="n">exec</span><span class="p">(</span><span class="nb">compile</span><span class="p">(</span><span class="nb">open</span><span class="p">(</span><span class="n">script</span><span class="p">)</span><span class="o">.</span><span class="n">read</span><span class="p">(),</span> <span class="n">script</span><span class="p">,</span> <span class="s1">&#39;exec&#39;</span><span class="p">))</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">script</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;initial.attributes&quot;</span><span class="p">:</span>
            <span class="n">vcs</span><span class="o">.</span><span class="n">_doValidation</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">loader</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;P&quot;</span><span class="p">:</span> <span class="s1">&#39;template&#39;</span><span class="p">,</span>
                  <span class="s2">&quot;Gfb&quot;</span><span class="p">:</span> <span class="s1">&#39;boxfill&#39;</span><span class="p">,</span>
                  <span class="s2">&quot;Gfi&quot;</span><span class="p">:</span> <span class="s1">&#39;isofill&#39;</span><span class="p">,</span>
                  <span class="s2">&quot;Gi&quot;</span><span class="p">:</span> <span class="s1">&#39;isoline&#39;</span><span class="p">,</span>
                  <span class="s2">&quot;Gvp&quot;</span><span class="p">:</span> <span class="s1">&#39;vector&#39;</span><span class="p">,</span>
                  <span class="s2">&quot;Gfm&quot;</span><span class="p">:</span> <span class="s1">&#39;meshfill&#39;</span><span class="p">,</span>
                  <span class="s2">&quot;G1d&quot;</span><span class="p">:</span> <span class="s1">&#39;1d&#39;</span><span class="p">,</span>
                  <span class="s2">&quot;Tf&quot;</span><span class="p">:</span> <span class="s1">&#39;fillarea&#39;</span><span class="p">,</span>
                  <span class="s2">&quot;Tt&quot;</span><span class="p">:</span> <span class="s2">&quot;texttable&quot;</span><span class="p">,</span>
                  <span class="s2">&quot;To&quot;</span><span class="p">:</span> <span class="s2">&quot;textorientation&quot;</span><span class="p">,</span>
                  <span class="s2">&quot;Tm&quot;</span><span class="p">:</span> <span class="s2">&quot;marker&quot;</span><span class="p">,</span>
                  <span class="s2">&quot;Tl&quot;</span><span class="p">:</span> <span class="s2">&quot;line&quot;</span><span class="p">,</span>
                  <span class="s2">&quot;Gf3Dscalar&quot;</span><span class="p">:</span> <span class="s2">&quot;3d_scalar&quot;</span><span class="p">,</span>
                  <span class="s2">&quot;Gf3DDualScalar&quot;</span><span class="p">:</span> <span class="s2">&quot;3d_dual_scalar&quot;</span><span class="p">,</span>
                  <span class="s2">&quot;Gf3Dvector&quot;</span><span class="p">:</span> <span class="s2">&quot;3d_vector&quot;</span><span class="p">,</span>
                  <span class="s2">&quot;Proj&quot;</span><span class="p">:</span> <span class="s2">&quot;projection&quot;</span><span class="p">,</span>
                  <span class="s2">&quot;Gtd&quot;</span><span class="p">:</span> <span class="s2">&quot;taylordiagram&quot;</span><span class="p">,</span>
                  <span class="s2">&quot;Cp&quot;</span><span class="p">:</span> <span class="s2">&quot;colormap&quot;</span><span class="p">,</span>
                  <span class="s2">&quot;L&quot;</span><span class="p">:</span> <span class="s2">&quot;L&quot;</span><span class="p">,</span>
                  <span class="p">}</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">f</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">script</span><span class="p">)</span>
            <span class="n">jsn</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
            <span class="n">keys</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;Tt&quot;</span><span class="p">,</span> <span class="s2">&quot;To&quot;</span><span class="p">,</span> <span class="s2">&quot;Tl&quot;</span><span class="p">,</span>
                      <span class="s2">&quot;Tm&quot;</span><span class="p">,</span> <span class="s2">&quot;Proj&quot;</span><span class="p">]:</span>  <span class="c1"># always read these first</span>
                <span class="k">if</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">jsn</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                    <span class="n">keys</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">jsn</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="k">if</span> <span class="n">k</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">keys</span><span class="p">:</span>
                    <span class="n">keys</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">typ</span> <span class="ow">in</span> <span class="n">keys</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">nm</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">jsn</span><span class="p">[</span><span class="n">typ</span><span class="p">]</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
                    <span class="k">if</span> <span class="n">typ</span> <span class="o">==</span> <span class="s2">&quot;P&quot;</span><span class="p">:</span>
                        <span class="k">try</span><span class="p">:</span>
                            <span class="n">loadTemplate</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">nm</span><span class="p">),</span> <span class="n">v</span><span class="p">)</span>
                        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
                            <span class="nb">print</span> <span class="s2">&quot;could not load tmpl:&quot;</span><span class="p">,</span> <span class="n">nm</span><span class="p">,</span> <span class="n">err</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="k">try</span><span class="p">:</span>
                            <span class="n">loadVCSItem</span><span class="p">(</span><span class="n">loader</span><span class="p">[</span><span class="n">typ</span><span class="p">],</span> <span class="n">nm</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span>
                        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
                            <span class="nb">print</span> <span class="s2">&quot;failed&quot;</span><span class="p">,</span> <span class="n">typ</span><span class="p">,</span> <span class="n">nm</span><span class="p">,</span> <span class="n">err</span>
        <span class="c1"># ok could not read json file maybe it is an old initial.attributes</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">script</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;initial.attributes&quot;</span><span class="p">:</span>
                <span class="n">_scriptrun</span><span class="p">(</span><span class="n">script</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s2">&quot;unable to source file: </span><span class="si">%s</span><span class="s2"> </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">script</span><span class="p">,</span> <span class="n">err</span><span class="p">))</span>
    <span class="n">vcs</span><span class="o">.</span><span class="n">_doValidation</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="k">return</span>


<span class="k">def</span> <span class="nf">loadTemplate</span><span class="p">(</span><span class="n">nm</span><span class="p">,</span> <span class="n">vals</span><span class="p">):</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">t</span> <span class="o">=</span> <span class="n">vcs</span><span class="o">.</span><span class="n">gettemplate</span><span class="p">(</span><span class="n">nm</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
        <span class="n">t</span> <span class="o">=</span> <span class="n">vcs</span><span class="o">.</span><span class="n">createtemplate</span><span class="p">(</span><span class="n">nm</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">vals</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
        <span class="n">A</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">a</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">v</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">unicode</span><span class="p">):</span>
                <span class="n">v</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>
            <span class="nb">setattr</span><span class="p">(</span><span class="n">A</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">loadVCSItem</span><span class="p">(</span><span class="n">typ</span><span class="p">,</span> <span class="n">nm</span><span class="p">,</span> <span class="n">json_dict</span><span class="o">=</span><span class="p">{}):</span>
    <span class="c1"># if typ==&quot;oneD&quot;:</span>
    <span class="c1">#  tp = &quot;oned&quot;</span>
    <span class="c1"># else:</span>
    <span class="c1">#  tp = typ</span>
    <span class="n">tp</span> <span class="o">=</span> <span class="n">typ</span>
    <span class="k">if</span> <span class="n">typ</span> <span class="o">==</span> <span class="s2">&quot;L&quot;</span><span class="p">:</span>
        <span class="n">d</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">json_dict</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">d</span><span class="p">[</span><span class="nb">eval</span><span class="p">(</span><span class="n">k</span><span class="p">)]</span> <span class="o">=</span> <span class="nb">eval</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="n">d</span><span class="p">[</span><span class="nb">eval</span><span class="p">(</span><span class="n">k</span><span class="p">)]</span> <span class="o">=</span> <span class="n">v</span>
        <span class="n">vcs</span><span class="o">.</span><span class="n">elements</span><span class="p">[</span><span class="s2">&quot;list&quot;</span><span class="p">][</span><span class="n">nm</span><span class="p">]</span> <span class="o">=</span> <span class="n">d</span>
        <span class="k">return</span>

    <span class="k">if</span> <span class="n">nm</span> <span class="ow">in</span> <span class="n">vcs</span><span class="o">.</span><span class="n">elements</span><span class="p">[</span><span class="n">tp</span><span class="p">]:</span>
        <span class="c1"># skip defaults and temp ones</span>
        <span class="k">if</span> <span class="n">nm</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;default_scatter_&quot;</span><span class="p">,</span> <span class="s2">&quot;default_xvsy_&quot;</span><span class="p">,</span>
                      <span class="s2">&quot;default_xyvsy_&quot;</span><span class="p">,</span> <span class="s2">&quot;default_yxvsx_&quot;</span><span class="p">]:</span>
            <span class="n">gm</span> <span class="o">=</span> <span class="n">vcs</span><span class="o">.</span><span class="n">elements</span><span class="p">[</span><span class="n">tp</span><span class="p">][</span><span class="n">nm</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">cmd</span> <span class="o">=</span> <span class="s2">&quot;gm = vcs.create</span><span class="si">%s</span><span class="s2">(&#39;</span><span class="si">%s</span><span class="s2">&#39;)&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">typ</span><span class="p">,</span> <span class="n">nm</span><span class="p">)</span>
        <span class="n">exec</span><span class="p">(</span><span class="n">cmd</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">a</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">json_dict</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">a</span> <span class="o">==</span> <span class="s2">&quot;Marker&quot;</span> <span class="ow">and</span> <span class="n">tp</span> <span class="o">==</span> <span class="s2">&quot;taylordiagram&quot;</span><span class="p">:</span>
                <span class="n">gm</span><span class="o">.</span><span class="n">addMarker</span><span class="p">()</span>
                <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">v</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                    <span class="n">cmd</span> <span class="o">=</span> <span class="s2">&quot;gm.Marker.</span><span class="si">%s</span><span class="s2"> = </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="nb">repr</span><span class="p">(</span><span class="n">v</span><span class="p">[</span><span class="n">k</span><span class="p">]))</span>
                    <span class="n">exec</span><span class="p">(</span><span class="n">cmd</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">v</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="n">v</span><span class="p">[</span><span class="nb">eval</span><span class="p">(</span><span class="n">k</span><span class="p">)]</span> <span class="o">=</span> <span class="n">v</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
                        <span class="k">del</span><span class="p">(</span><span class="n">v</span><span class="p">[</span><span class="n">k</span><span class="p">])</span>
                    <span class="k">except</span><span class="p">:</span>
                        <span class="k">pass</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">unicode</span><span class="p">):</span>
            <span class="n">v</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span><span class="p">(</span><span class="n">a</span> <span class="o">==</span> <span class="s2">&quot;Marker&quot;</span> <span class="ow">and</span> <span class="n">tp</span> <span class="o">==</span> <span class="s2">&quot;taylordiagram&quot;</span><span class="p">):</span>
            <span class="nb">setattr</span><span class="p">(</span><span class="n">gm</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">gm</span>


<span class="k">def</span> <span class="nf">return_display_names</span><span class="p">():</span>
    <span class="k">return</span> <span class="p">[</span><span class="s2">&quot;&quot;</span><span class="p">],</span> <span class="p">[</span><span class="s2">&quot;&quot;</span><span class="p">]</span>


<span class="k">def</span> <span class="nf">getdotdirectory</span><span class="p">():</span>
    <span class="k">return</span> <span class="s2">&quot;.uvcdat&quot;</span><span class="p">,</span> <span class="s2">&quot;UVCDAT_DIR&quot;</span>


<span class="k">class</span> <span class="nc">VCSUtilsError</span> <span class="p">(</span><span class="ne">Exception</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Create an exception&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">args</span> <span class="o">=</span> <span class="n">args</span>

    <span class="k">def</span> <span class="nf">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Calculate the string representation&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="p">)</span>
    <span class="n">__repr__</span> <span class="o">=</span> <span class="n">__str__</span>


<div class="viewcode-block" id="minmax"><a class="viewcode-back" href="../../vcs/misc/utils.html#vcs.utils.minmax">[docs]</a><span class="k">def</span> <span class="nf">minmax</span><span class="p">(</span><span class="o">*</span><span class="n">data</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Return the minimum and maximum of a series of array/list/tuples</span>
<span class="sd">    (or combination of these)</span>
<span class="sd">    You can combine list/tuples/arrays pretty much any combination is allowed</span>

<span class="sd">    :Example:</span>

<span class="sd">        .. doctest:: utils_minmax</span>

<span class="sd">            &gt;&gt;&gt; s=range(7)</span>
<span class="sd">            &gt;&gt;&gt; vcs.minmax(s)</span>
<span class="sd">            (0.0, 6.0)</span>
<span class="sd">            &gt;&gt;&gt; vcs.minmax([s,s])</span>
<span class="sd">            (0.0, 6.0)</span>
<span class="sd">            &gt;&gt;&gt; vcs.minmax([[s,s*2],4.,[6.,7.,s]],[5.,-7.,8,(6.,1.)])</span>
<span class="sd">            (-7.0, 8.0)</span>

<span class="sd">    :param data: A comma-separated list of lists/arrays/tuples</span>
<span class="sd">    :type data: list</span>

<span class="sd">    :returns: A tuple in the form (min, max)</span>
<span class="sd">    :rtype: tuple</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">mx</span> <span class="o">=</span> <span class="o">-</span><span class="mf">1.E77</span>
    <span class="n">mn</span> <span class="o">=</span> <span class="mf">1.E77</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">global</span> <span class="n">myfunction</span>

    <span class="k">def</span> <span class="nf">myfunction</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="n">mx</span><span class="p">,</span> <span class="n">mn</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">d</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">mx</span><span class="p">,</span> <span class="n">mn</span>
        <span class="kn">from</span> <span class="nn">numpy.ma</span> <span class="k">import</span> <span class="n">maximum</span><span class="p">,</span> <span class="n">minimum</span><span class="p">,</span> <span class="n">count</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">count</span><span class="p">(</span><span class="n">d</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">mx</span><span class="p">,</span> <span class="n">mn</span>
            <span class="n">mx</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">maximum</span><span class="p">(</span><span class="n">mx</span><span class="p">,</span> <span class="nb">float</span><span class="p">(</span><span class="n">maximum</span><span class="p">(</span><span class="n">d</span><span class="p">))))</span>
            <span class="n">mn</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">minimum</span><span class="p">(</span><span class="n">mn</span><span class="p">,</span> <span class="nb">float</span><span class="p">(</span><span class="n">minimum</span><span class="p">(</span><span class="n">d</span><span class="p">))))</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">d</span><span class="p">:</span>
                <span class="n">mx</span><span class="p">,</span> <span class="n">mn</span> <span class="o">=</span> <span class="n">myfunction</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">mx</span><span class="p">,</span> <span class="n">mn</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">mx</span><span class="p">,</span> <span class="n">mn</span>
    <span class="n">mx</span><span class="p">,</span> <span class="n">mn</span> <span class="o">=</span> <span class="n">myfunction</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">mx</span><span class="p">,</span> <span class="n">mn</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">mn</span> <span class="o">==</span> <span class="mf">1.E77</span> <span class="ow">and</span> <span class="n">mx</span> <span class="o">==</span> <span class="o">-</span><span class="mf">1.E77</span><span class="p">:</span>
        <span class="n">mn</span><span class="p">,</span> <span class="n">mx</span> <span class="o">=</span> <span class="mf">1.E20</span><span class="p">,</span> <span class="mf">1.E20</span>
    <span class="k">return</span> <span class="n">mn</span><span class="p">,</span> <span class="n">mx</span></div>


<div class="viewcode-block" id="mkevenlevels"><a class="viewcode-back" href="../../vcs/misc/utils.html#vcs.utils.mkevenlevels">[docs]</a><span class="k">def</span> <span class="nf">mkevenlevels</span><span class="p">(</span><span class="n">n1</span><span class="p">,</span> <span class="n">n2</span><span class="p">,</span> <span class="n">nlev</span><span class="o">=</span><span class="mi">10</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Return a series of evenly spaced levels going from n1 to n2.</span>
<span class="sd">    By default 10 intervals will be produced.</span>

<span class="sd">    :Example:</span>

<span class="sd">        .. doctest:: utils_mkevenlevels</span>

<span class="sd">            &gt;&gt;&gt; vcs.mkevenlevels(0,100)</span>
<span class="sd">            [0.0, 10.0, 20.0, 30.0, 40.0, 50.0, 60.0, 70.0, 80.0, 90.0, 100.0]</span>
<span class="sd">            &gt;&gt;&gt; vcs.mkevenlevels(0,100,nlev=5)</span>
<span class="sd">            [0.0, 20.0, 40.0, 60.0, 80.0, 100.0]</span>
<span class="sd">            &gt;&gt;&gt; vcs.mkevenlevels(100,0,nlev=5)</span>
<span class="sd">            [100.0, 80.0, 60.0, 40.0, 20.0, 0.0]</span>

<span class="sd">    :param n1: Beginning of range. Int or float.</span>
<span class="sd">    :type n1: int, float</span>

<span class="sd">    :param n2: End of range. Int or float.</span>
<span class="sd">    :type n2: int, float</span>

<span class="sd">    :param nlev: Number of levels by which to split the given range.</span>
<span class="sd">    :type nlev: int</span>

<span class="sd">    :returns: List of floats, splitting range evenly between n1 and n2</span>
<span class="sd">    :rtype: list</span>
<span class="sd">&quot;&quot;&quot;</span>
    <span class="kn">import</span> <span class="nn">numpy.ma</span>
    <span class="n">lev</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ma</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">nlev</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">float</span><span class="p">)</span>
    <span class="n">factor</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">n2</span> <span class="o">-</span> <span class="n">n1</span><span class="p">)</span> <span class="o">/</span> <span class="n">nlev</span>
    <span class="n">lev</span> <span class="o">=</span> <span class="n">factor</span> <span class="o">*</span> <span class="n">lev</span>
    <span class="n">lev</span> <span class="o">=</span> <span class="n">lev</span> <span class="o">+</span> <span class="n">n1</span>
    <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="n">lev</span><span class="p">)</span></div>


<div class="viewcode-block" id="mkscale"><a class="viewcode-back" href="../../vcs/misc/utils.html#vcs.utils.mkscale">[docs]</a><span class="k">def</span> <span class="nf">mkscale</span><span class="p">(</span><span class="n">n1</span><span class="p">,</span> <span class="n">n2</span><span class="p">,</span> <span class="n">nc</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span> <span class="n">zero</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">ends</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This function return a nice scale given a min and a max</span>

<span class="sd">    .. warning::</span>

<span class="sd">        Not all functionality for the &#39;zero&#39; parameter has been implemented.</span>
<span class="sd">        zero=0 is intended to let the function decide what should be done with zeros,</span>
<span class="sd">        but it has yet to be defined. Do not use zero=0.</span>

<span class="sd">    :Examples:</span>

<span class="sd">        .. doctest:: utils_mkscale</span>

<span class="sd">            &gt;&gt;&gt; vcs.mkscale(0,100)</span>
<span class="sd">            [0.0, 10.0, 20.0, 30.0, 40.0, 50.0, 60.0, 70.0, 80.0, 90.0, 100.0]</span>
<span class="sd">            &gt;&gt;&gt; vcs.mkscale(0,100,nc=5)</span>
<span class="sd">            [0.0, 20.0, 40.0, 60.0, 80.0, 100.0]</span>
<span class="sd">            &gt;&gt;&gt; vcs.mkscale(-10,100,nc=5)</span>
<span class="sd">            [-25.0, 0.0, 25.0, 50.0, 75.0, 100.0]</span>
<span class="sd">            &gt;&gt;&gt; vcs.mkscale(-10,100,nc=5,zero=-1)</span>
<span class="sd">            [-20.0, 20.0, 60.0, 100.0]</span>
<span class="sd">            &gt;&gt;&gt; vcs.mkscale(2,20)</span>
<span class="sd">            [2.0, 4.0, 6.0, 8.0, 10.0, 12.0, 14.0, 16.0, 18.0, 20.0]</span>
<span class="sd">            &gt;&gt;&gt; vcs.mkscale(2,20,zero=2)</span>
<span class="sd">            [0.0, 2.0, 4.0, 6.0, 8.0, 10.0, 12.0, 14.0, 16.0, 18.0, 20.0]</span>

<span class="sd">    :param n1: Minimum number in range.</span>
<span class="sd">    :type n1: float</span>

<span class="sd">    :param n2: Maximum number in range.</span>
<span class="sd">    :type n2: float</span>

<span class="sd">    :param nc: Maximum number of intervals</span>
<span class="sd">    :type nc: int</span>

<span class="sd">    :param zero: Integer flag to indicate how zero should be handled. Flags are as follows</span>
<span class="sd">                   -1: zero MUST NOT be a contour</span>
<span class="sd">                    0: let the function decide # NOT IMPLEMENTED</span>
<span class="sd">                    1: zero CAN be a contour  (default)</span>
<span class="sd">                    2: zero MUST be a contour</span>
<span class="sd">    :type zero: int</span>

<span class="sd">    :param end: Boolean value indicating whether n1 and n2 should be part of the returned labels.</span>
<span class="sd">                Defaults to False.</span>
<span class="sd">    :type end: bool</span>

<span class="sd">    :returns: List of floats split into nc intervals</span>
<span class="sd">    :rtype: list</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">n1</span> <span class="o">==</span> <span class="n">n2</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">n1</span><span class="p">]</span>
    <span class="kn">import</span> <span class="nn">numpy</span>
    <span class="n">nc</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">nc</span><span class="p">)</span>
    <span class="n">cscale</span> <span class="o">=</span> <span class="mi">0</span>  <span class="c1"># ???? May be later</span>
    <span class="nb">min</span><span class="p">,</span> <span class="nb">max</span> <span class="o">=</span> <span class="n">minmax</span><span class="p">(</span><span class="n">n1</span><span class="p">,</span> <span class="n">n2</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">zero</span> <span class="o">&gt;</span> <span class="mf">1.</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">min</span> <span class="o">&gt;</span> <span class="mf">0.</span><span class="p">:</span>
            <span class="nb">min</span> <span class="o">=</span> <span class="mf">0.</span>
        <span class="k">if</span> <span class="nb">max</span> <span class="o">&lt;</span> <span class="mf">0.</span><span class="p">:</span>
            <span class="nb">max</span> <span class="o">=</span> <span class="mf">0.</span>
    <span class="n">rg</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="nb">max</span> <span class="o">-</span> <span class="nb">min</span><span class="p">)</span>  <span class="c1"># range</span>
    <span class="k">if</span> <span class="n">rg</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">[</span><span class="nb">min</span><span class="p">,</span> <span class="p">]</span>
    <span class="n">delta</span> <span class="o">=</span> <span class="n">rg</span> <span class="o">/</span> <span class="n">nc</span>  <span class="c1"># basic delta</span>
    <span class="c1"># scale delta to be &gt;10 and &lt;= 100</span>
    <span class="n">lg</span> <span class="o">=</span> <span class="o">-</span><span class="n">numpy</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">delta</span><span class="p">)</span> <span class="o">+</span> <span class="mf">2.</span>
    <span class="n">il</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="n">lg</span><span class="p">)</span>
    <span class="n">delta</span> <span class="o">=</span> <span class="n">delta</span> <span class="o">*</span> <span class="p">(</span><span class="mf">10.</span> <span class="o">**</span> <span class="n">il</span><span class="p">)</span>
    <span class="nb">max</span> <span class="o">=</span> <span class="nb">max</span> <span class="o">*</span> <span class="p">(</span><span class="mf">10.</span> <span class="o">**</span> <span class="n">il</span><span class="p">)</span>
    <span class="nb">min</span> <span class="o">=</span> <span class="nb">min</span> <span class="o">*</span> <span class="p">(</span><span class="mf">10.</span> <span class="o">**</span> <span class="n">il</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">zero</span> <span class="o">&gt;</span> <span class="o">-</span><span class="mf">0.5</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">delta</span> <span class="o">&lt;=</span> <span class="mf">20.</span><span class="p">:</span>
            <span class="n">delta</span> <span class="o">=</span> <span class="mi">20</span>
        <span class="k">elif</span> <span class="n">delta</span> <span class="o">&lt;=</span> <span class="mf">25.</span><span class="p">:</span>
            <span class="n">delta</span> <span class="o">=</span> <span class="mi">25</span>
        <span class="k">elif</span> <span class="n">delta</span> <span class="o">&lt;=</span> <span class="mf">40.</span><span class="p">:</span>
            <span class="n">delta</span> <span class="o">=</span> <span class="mi">40</span>
        <span class="k">elif</span> <span class="n">delta</span> <span class="o">&lt;=</span> <span class="mf">50.</span><span class="p">:</span>
            <span class="n">delta</span> <span class="o">=</span> <span class="mi">50</span>
        <span class="k">elif</span> <span class="n">delta</span> <span class="o">&lt;=</span> <span class="mf">101.</span><span class="p">:</span>
            <span class="n">delta</span> <span class="o">=</span> <span class="mi">100</span>
        <span class="n">first</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="nb">min</span> <span class="o">/</span> <span class="n">delta</span><span class="p">)</span> <span class="o">-</span> <span class="mf">1.</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">delta</span> <span class="o">&lt;=</span> <span class="mf">20.</span><span class="p">:</span>
            <span class="n">delta</span> <span class="o">=</span> <span class="mi">20</span>
        <span class="k">elif</span> <span class="n">delta</span> <span class="o">&lt;=</span> <span class="mf">40.</span><span class="p">:</span>
            <span class="n">delta</span> <span class="o">=</span> <span class="mi">40</span>
        <span class="k">elif</span> <span class="n">delta</span> <span class="o">&lt;=</span> <span class="mf">60.</span><span class="p">:</span>
            <span class="n">delta</span> <span class="o">=</span> <span class="mi">60</span>
        <span class="k">elif</span> <span class="n">delta</span> <span class="o">&lt;=</span> <span class="mf">101.</span><span class="p">:</span>
            <span class="n">delta</span> <span class="o">=</span> <span class="mi">100</span>
        <span class="n">first</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="nb">min</span> <span class="o">/</span> <span class="n">delta</span><span class="p">)</span> <span class="o">-</span> <span class="mf">1.5</span>

    <span class="k">if</span> <span class="n">ends</span><span class="p">:</span>
        <span class="n">scvals</span> <span class="o">=</span> <span class="n">n1</span> <span class="o">+</span> <span class="n">delta</span> <span class="o">*</span> <span class="n">numpy</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">nc</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">scvals</span> <span class="o">=</span> <span class="n">delta</span> <span class="o">*</span> <span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">nc</span><span class="p">)</span> <span class="o">+</span> <span class="n">first</span><span class="p">)</span>

    <span class="n">a</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">scvals</span><span class="p">)):</span>
        <span class="k">if</span> <span class="n">scvals</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">&gt;</span> <span class="nb">min</span><span class="p">:</span>
            <span class="n">a</span> <span class="o">=</span> <span class="n">j</span> <span class="o">-</span> <span class="mi">1</span>
            <span class="k">break</span>
    <span class="n">b</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">scvals</span><span class="p">)):</span>
        <span class="k">if</span> <span class="n">scvals</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="nb">max</span><span class="p">:</span>
            <span class="n">b</span> <span class="o">=</span> <span class="n">j</span> <span class="o">+</span> <span class="mi">1</span>
            <span class="k">break</span>
    <span class="k">if</span> <span class="n">cscale</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">cnt</span> <span class="o">=</span> <span class="n">scvals</span><span class="p">[</span><span class="n">a</span><span class="p">:</span><span class="n">b</span><span class="p">]</span> <span class="o">/</span> <span class="mf">10.</span> <span class="o">**</span> <span class="n">il</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># not done yet...</span>
        <span class="k">raise</span> <span class="n">VCSUtilsError</span><span class="p">(</span><span class="s1">&#39;ERROR scale not implemented in this function&#39;</span><span class="p">)</span>
    <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="n">cnt</span><span class="p">)</span></div>


<span class="k">def</span> <span class="nf">__split2contiguous</span><span class="p">(</span><span class="n">levels</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Function __split2contiguous(levels)</span>
<span class="sd">    takes list of split intervals and make it contiguous if possible</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">tmplevs</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">il</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">levels</span><span class="p">)):</span>
        <span class="n">lv</span> <span class="o">=</span> <span class="n">levels</span><span class="p">[</span><span class="n">il</span><span class="p">]</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">lv</span><span class="p">,</span> <span class="nb">list</span><span class="p">)</span> <span class="ow">or</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">lv</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">)):</span>
            <span class="k">raise</span> <span class="n">VCSUtilsError</span><span class="p">(</span><span class="s2">&quot;Error levels must be a set of intervals&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">len</span><span class="p">(</span><span class="n">lv</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">VCSUtilsError</span><span class="p">(</span><span class="s2">&quot;Error intervals can only have 2 elements&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">il</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">lv2</span> <span class="o">=</span> <span class="n">levels</span><span class="p">[</span><span class="n">il</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">lv2</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">!=</span> <span class="n">lv</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
                <span class="k">raise</span> <span class="n">VCSUtilsError</span><span class="p">(</span><span class="s2">&quot;Error intervals are NOT contiguous from &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">lv2</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">+</span> <span class="s2">&quot; to &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">lv</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
        <span class="n">tmplevs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">lv</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="n">tmplevs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">levels</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">])</span>
    <span class="k">return</span> <span class="n">tmplevs</span>


<div class="viewcode-block" id="mklabels"><a class="viewcode-back" href="../../vcs/misc/utils.html#vcs.utils.mklabels">[docs]</a><span class="k">def</span> <span class="nf">mklabels</span><span class="p">(</span><span class="n">vals</span><span class="p">,</span> <span class="n">output</span><span class="o">=</span><span class="s1">&#39;dict&#39;</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This function gets levels and output strings for nice display of the</span>
<span class="sd">    levels values.</span>

<span class="sd">    :Examples:</span>

<span class="sd">        .. doctest:: utils_mklabels</span>

<span class="sd">            &gt;&gt;&gt; a=vcs.mkscale(2,20,zero=2)</span>
<span class="sd">            &gt;&gt;&gt; vcs.mklabels (a)</span>
<span class="sd">            {20.0: &#39;20&#39;, 18.0: &#39;18&#39;, 16.0: &#39;16&#39;, 14.0: &#39;14&#39;, 12.0: &#39;12&#39;,</span>
<span class="sd">                10.0: &#39;10&#39;, 8.0: &#39;8&#39;, 6.0: &#39;6&#39;, 4.0: &#39;4&#39;, 2.0: &#39;2&#39;, 0.0: &#39;0&#39;}</span>
<span class="sd">            &gt;&gt;&gt; vcs.mklabels ( [5,.005])</span>
<span class="sd">            {0.0050000000000000001: &#39;0.005&#39;, 5.0: &#39;5.000&#39;}</span>
<span class="sd">            &gt;&gt;&gt; vcs.mklabels ( [.00002,.00005])</span>
<span class="sd">            {2.0000000000000002e-05: &#39;2E-5&#39;, 5.0000000000000002e-05: &#39;5E-5&#39;}</span>
<span class="sd">            &gt;&gt;&gt; vcs.mklabels ( [.00002,.00005],output=&#39;list&#39;)</span>
<span class="sd">            [&#39;2E-5&#39;, &#39;5E-5&#39;]</span>

<span class="sd">    :param vals: List or tuple of float values</span>
<span class="sd">    :type vals: list, tuple</span>

<span class="sd">    :param output: Specifies the desired output type. One of [&#39;dict&#39;, &#39;list&#39;].</span>
<span class="sd">    :type output: str</span>

<span class="sd">    :returns: Dictionary or list of labels for the given values.</span>
<span class="sd">    :rtype: dict, list</span>
<span class="sd">        &quot;&quot;&quot;</span>
    <span class="kn">import</span> <span class="nn">string</span>
    <span class="kn">import</span> <span class="nn">numpy.ma</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">vals</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="nb">list</span><span class="p">)</span> <span class="ow">or</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">vals</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="nb">tuple</span><span class="p">):</span>
        <span class="n">vals</span> <span class="o">=</span> <span class="n">__split2contiguous</span><span class="p">(</span><span class="n">vals</span><span class="p">)</span>
    <span class="n">vals</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ma</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">vals</span><span class="p">)</span>
    <span class="n">nvals</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">vals</span><span class="p">)</span>
    <span class="n">ineg</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="c1"># Finds maximum number to write</span>
    <span class="n">amax</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">ma</span><span class="o">.</span><span class="n">maximum</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">ma</span><span class="o">.</span><span class="n">absolute</span><span class="p">(</span><span class="n">vals</span><span class="p">)))</span>
    <span class="k">if</span> <span class="n">amax</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">string</span><span class="o">.</span><span class="n">lower</span><span class="p">(</span><span class="n">output</span><span class="p">[:</span><span class="mi">3</span><span class="p">])</span> <span class="o">==</span> <span class="s1">&#39;dic&#39;</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">{</span><span class="mi">0</span><span class="p">:</span> <span class="s1">&#39;0&#39;</span><span class="p">}</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">[</span><span class="s1">&#39;0&#39;</span><span class="p">]</span>
    <span class="n">amin</span><span class="p">,</span> <span class="n">amax</span> <span class="o">=</span> <span class="n">minmax</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">ma</span><span class="o">.</span><span class="n">masked_equal</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">ma</span><span class="o">.</span><span class="n">absolute</span><span class="p">(</span><span class="n">vals</span><span class="p">),</span> <span class="mi">0</span><span class="p">))</span>
    <span class="n">ratio</span> <span class="o">=</span> <span class="n">amax</span> <span class="o">/</span> <span class="n">amin</span>
    <span class="k">if</span> <span class="nb">int</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">ma</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">ma</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">ratio</span><span class="p">)))</span> <span class="o">+</span> <span class="mi">1</span> <span class="o">&gt;</span> <span class="mi">6</span><span class="p">:</span>
        <span class="n">lbls</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nvals</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">vals</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">lbls</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">mklabels</span><span class="p">([</span><span class="n">vals</span><span class="p">[</span><span class="n">i</span><span class="p">]],</span> <span class="n">output</span><span class="o">=</span><span class="s1">&#39;list&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">lbls</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;0&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">string</span><span class="o">.</span><span class="n">lower</span><span class="p">(</span><span class="n">output</span><span class="p">[:</span><span class="mi">3</span><span class="p">])</span> <span class="o">==</span> <span class="s1">&#39;dic&#39;</span><span class="p">:</span>
            <span class="n">dic</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">vals</span><span class="p">)):</span>
                <span class="n">dic</span><span class="p">[</span><span class="nb">float</span><span class="p">(</span><span class="n">vals</span><span class="p">[</span><span class="n">i</span><span class="p">])]</span> <span class="o">=</span> <span class="n">lbls</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
            <span class="k">return</span> <span class="n">dic</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">lbls</span>
    <span class="n">tmax</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">ma</span><span class="o">.</span><span class="n">maximum</span><span class="p">(</span><span class="n">vals</span><span class="p">))</span>
    <span class="k">if</span> <span class="n">tmax</span> <span class="o">&lt;</span> <span class="mf">0.</span><span class="p">:</span>
        <span class="n">ineg</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="n">vals</span> <span class="o">=</span> <span class="o">-</span><span class="n">vals</span>
        <span class="n">amax</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">ma</span><span class="o">.</span><span class="n">maximum</span><span class="p">(</span><span class="n">vals</span><span class="p">))</span>
    <span class="c1">#  Number of digit on the left of decimal point</span>
    <span class="n">idigleft</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">ma</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">ma</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">amax</span><span class="p">)))</span> <span class="o">+</span> <span class="mi">1</span>

    <span class="c1"># Now determine the number of significant figures</span>
    <span class="n">idig</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nvals</span><span class="p">):</span>
        <span class="n">aa</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ma</span><span class="o">.</span><span class="n">power</span><span class="p">(</span><span class="mf">10.</span><span class="p">,</span> <span class="o">-</span><span class="n">idigleft</span><span class="p">)</span>
        <span class="k">while</span> <span class="nb">abs</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">aa</span> <span class="o">*</span> <span class="n">vals</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="o">-</span> <span class="n">aa</span> <span class="o">*</span> <span class="n">vals</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="o">&gt;</span> <span class="o">.</span><span class="mi">000001</span><span class="p">:</span>
            <span class="n">aa</span> <span class="o">=</span> <span class="n">aa</span> <span class="o">*</span> <span class="mf">10.</span>
        <span class="n">idig</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ma</span><span class="o">.</span><span class="n">maximum</span><span class="p">(</span><span class="n">idig</span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ma</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">ma</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">aa</span> <span class="o">*</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ma</span><span class="o">.</span><span class="n">power</span><span class="p">(</span><span class="mf">10.</span><span class="p">,</span> <span class="n">idigleft</span><span class="p">))))</span>
    <span class="n">idig</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">idig</span><span class="p">)</span>

    <span class="c1"># Now does the writing part</span>
    <span class="n">lbls</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="c1"># First if we need an E format</span>
    <span class="k">if</span> <span class="n">idigleft</span> <span class="o">&gt;</span> <span class="mi">5</span> <span class="ow">or</span> <span class="n">idigleft</span> <span class="o">&lt;</span> <span class="o">-</span><span class="mi">2</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">idig</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nvals</span><span class="p">):</span>
                <span class="n">aa</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">vals</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">/</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ma</span><span class="o">.</span><span class="n">power</span><span class="p">(</span><span class="mf">10.</span><span class="p">,</span> <span class="n">idigleft</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)))</span>
                <span class="n">lbls</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">aa</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;E&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">idigleft</span> <span class="o">-</span> <span class="mi">1</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nvals</span><span class="p">):</span>
                <span class="n">aa</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">vals</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">/</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ma</span><span class="o">.</span><span class="n">power</span><span class="p">(</span><span class="mf">10.</span><span class="p">,</span> <span class="n">idigleft</span> <span class="o">-</span> <span class="mi">1</span><span class="p">))</span>
                <span class="n">ii</span> <span class="o">=</span> <span class="mi">1</span>
                <span class="k">if</span> <span class="n">vals</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mf">0.</span><span class="p">:</span>
                    <span class="n">ii</span> <span class="o">=</span> <span class="mi">2</span>
                <span class="n">aa</span> <span class="o">=</span> <span class="n">string</span><span class="o">.</span><span class="n">ljust</span><span class="p">(</span><span class="n">aa</span><span class="p">,</span> <span class="n">idig</span> <span class="o">+</span> <span class="n">ii</span><span class="p">)</span>
                <span class="n">aa</span> <span class="o">=</span> <span class="n">string</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">aa</span><span class="p">,</span> <span class="s1">&#39; &#39;</span><span class="p">,</span> <span class="s1">&#39;0&#39;</span><span class="p">)</span>
                <span class="n">lbls</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">aa</span> <span class="o">+</span> <span class="s1">&#39;E&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">idigleft</span> <span class="o">-</span> <span class="mi">1</span><span class="p">))</span>
    <span class="k">elif</span> <span class="n">idigleft</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">idigleft</span> <span class="o">&gt;=</span> <span class="n">idig</span><span class="p">:</span>  <span class="c1"># F format</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nvals</span><span class="p">):</span>
            <span class="n">lbls</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">vals</span><span class="p">[</span><span class="n">i</span><span class="p">]))))</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nvals</span><span class="p">):</span>
            <span class="n">ii</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="k">if</span> <span class="n">vals</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mf">0.</span><span class="p">:</span>
                <span class="n">ii</span> <span class="o">=</span> <span class="mi">2</span>
            <span class="n">ndig</span> <span class="o">=</span> <span class="n">idig</span> <span class="o">+</span> <span class="n">ii</span>
            <span class="n">rdig</span> <span class="o">=</span> <span class="n">idig</span> <span class="o">-</span> <span class="n">idigleft</span>
            <span class="k">if</span> <span class="n">idigleft</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">ndig</span> <span class="o">=</span> <span class="n">idig</span> <span class="o">-</span> <span class="n">idigleft</span> <span class="o">+</span> <span class="mi">1</span> <span class="o">+</span> <span class="n">ii</span>
            <span class="n">aa</span> <span class="o">=</span> <span class="s1">&#39;%&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">ndig</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;.&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">rdig</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;f&#39;</span>
            <span class="n">aa</span> <span class="o">=</span> <span class="n">aa</span> <span class="o">%</span> <span class="n">vals</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
            <span class="n">lbls</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">aa</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">ineg</span><span class="p">:</span>
        <span class="n">vals</span> <span class="o">=</span> <span class="o">-</span><span class="n">vals</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">lbls</span><span class="p">)):</span>
            <span class="n">lbls</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;-&#39;</span> <span class="o">+</span> <span class="n">lbls</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">string</span><span class="o">.</span><span class="n">lower</span><span class="p">(</span><span class="n">output</span><span class="p">[:</span><span class="mi">3</span><span class="p">])</span> <span class="o">==</span> <span class="s1">&#39;dic&#39;</span><span class="p">:</span>
        <span class="n">dic</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">vals</span><span class="p">)):</span>
            <span class="n">dic</span><span class="p">[</span><span class="nb">float</span><span class="p">(</span><span class="n">vals</span><span class="p">[</span><span class="n">i</span><span class="p">])]</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">lbls</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
        <span class="k">return</span> <span class="n">dic</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">lbls</span></div>


<div class="viewcode-block" id="getcolors"><a class="viewcode-back" href="../../vcs/misc/utils.html#vcs.utils.getcolors">[docs]</a><span class="k">def</span> <span class="nf">getcolors</span><span class="p">(</span><span class="n">levs</span><span class="p">,</span> <span class="n">colors</span><span class="o">=</span><span class="nb">range</span><span class="p">(</span><span class="mi">16</span><span class="p">,</span> <span class="mi">240</span><span class="p">),</span> <span class="n">split</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">white</span><span class="o">=</span><span class="mi">240</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    For isofill/boxfill purposes</span>
<span class="sd">    Given a list of levels this function returns the colors that would</span>
<span class="sd">    best spread a list of &quot;user-defined&quot; colors (default is 16 to 239,</span>
<span class="sd">    i.e 224 colors), always using the first and last color.</span>
<span class="sd">    Optionally the color range can be split into 2 equal domain to</span>
<span class="sd">    represent &lt;0 and &gt;0 values.</span>
<span class="sd">    If the colors are split an interval goes from &lt;0 to &gt;0</span>
<span class="sd">    then this is assigned the &quot;white&quot; color</span>

<span class="sd">    :Example:</span>

<span class="sd">        .. doctest:: utils_getcolors</span>

<span class="sd">            &gt;&gt;&gt; a=[0.0, 2.0, 4.0, 6.0, 8.0, 10.0, 12.0, 14.0, 16.0, 18.0, 20.0]</span>
<span class="sd">            &gt;&gt;&gt; vcs.getcolors (a)</span>
<span class="sd">            [16, 41, 66, 90, 115, 140, 165, 189, 214, 239]</span>
<span class="sd">            &gt;&gt;&gt; vcs.getcolors (a,colors=range(16,200))</span>
<span class="sd">            [16, 36, 57, 77, 97, 118, 138, 158, 179, 199]</span>
<span class="sd">            &gt;&gt;&gt; vcs.getcolors(a,colors=[16,25,15,56,35,234,12,11,19,32,132,17])</span>
<span class="sd">            [16, 25, 15, 35, 234, 12, 11, 32, 132, 17]</span>
<span class="sd">            &gt;&gt;&gt; a=[-6.0, -2.0, 2.0, 6.0, 10.0, 14.0, 18.0, 22.0, 26.0]</span>
<span class="sd">            &gt;&gt;&gt; vcs.getcolors (a,white=241)</span>
<span class="sd">            [72, 241, 128, 150, 172, 195, 217, 239]</span>
<span class="sd">            &gt;&gt;&gt; vcs.getcolors (a,white=241,split=0)</span>
<span class="sd">            [16, 48, 80, 112, 143, 175, 207, 239]</span>


<span class="sd">    :param levs: levels defining the color ranges</span>
<span class="sd">    :type levs: list, tuple</span>

<span class="sd">    :param colors: A list/tuple of the of colors you wish to use</span>
<span class="sd">    :type colors: list</span>

<span class="sd">    :param split: Integer flag to split colors between two equal domains.</span>
<span class="sd">                    0 : no split</span>
<span class="sd">                    1 : split if the levels go from &lt;0 to &gt;0</span>
<span class="sd">                    2 : split even if all the values are positive or negative</span>
<span class="sd">    :type split: int</span>

<span class="sd">    :param white: If split is on and an interval goes from &lt;0 to &gt;0 this color number</span>
<span class="sd">                  will be used within this interval (240 is white in the default VCS palette color).</span>
<span class="sd">                  Integer must be between 0 and 255.</span>
<span class="sd">    :type white: int</span>

<span class="sd">    :returns: List of colors</span>
<span class="sd">    :rtype: list</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="kn">import</span> <span class="nn">string</span>

    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">levs</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">colors</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">levs</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="nb">list</span><span class="p">)</span> <span class="ow">or</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">levs</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="nb">tuple</span><span class="p">):</span>
        <span class="n">tmplevs</span> <span class="o">=</span> <span class="p">[</span><span class="n">levs</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">levs</span><span class="p">)):</span>
            <span class="k">if</span> <span class="n">i</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">levs</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">levs</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mf">0.</span><span class="p">:</span>
                    <span class="n">tmplevs</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.</span>
            <span class="n">tmplevs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">levs</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">1</span><span class="p">])</span>
        <span class="n">levs</span> <span class="o">=</span> <span class="n">tmplevs</span>
    <span class="c1"># Take care of the input argument split</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">split</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">split</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;no&#39;</span><span class="p">:</span>
            <span class="n">split</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">elif</span> <span class="n">split</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;force&#39;</span><span class="p">:</span>
            <span class="n">split</span> <span class="o">=</span> <span class="mi">2</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">split</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="c1"># Take care of argument white</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">white</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
        <span class="n">white</span> <span class="o">=</span> <span class="n">string</span><span class="o">.</span><span class="n">atoi</span><span class="p">(</span><span class="n">white</span><span class="p">)</span>

    <span class="c1"># Gets first and last value, and adjust if extensions</span>
    <span class="n">mn</span> <span class="o">=</span> <span class="n">levs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">mx</span> <span class="o">=</span> <span class="n">levs</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    <span class="c1"># If first level is &lt; -1.E20 then use 2nd level for mn</span>
    <span class="k">if</span> <span class="n">levs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="o">-</span><span class="mf">9.E19</span> <span class="ow">and</span> <span class="n">levs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mf">0.</span><span class="p">:</span>
        <span class="n">mn</span> <span class="o">=</span> <span class="n">levs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
    <span class="c1"># If last level is &gt; 1.E20 then use 2nd to last level for mx</span>
    <span class="k">if</span> <span class="n">levs</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="mf">9.E19</span> <span class="ow">and</span> <span class="n">levs</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mf">0.</span><span class="p">:</span>
        <span class="n">mx</span> <span class="o">=</span> <span class="n">levs</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span>
    <span class="c1"># Do we need to split the palette in 2 ?</span>
    <span class="n">sep</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">if</span> <span class="n">mx</span> <span class="o">*</span> <span class="n">mn</span> <span class="o">&lt;</span> <span class="mf">0.</span> <span class="ow">and</span> <span class="n">split</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">sep</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="k">if</span> <span class="n">split</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
        <span class="n">sep</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="c1"># Determine the number of colors to use</span>
    <span class="n">nc</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">levs</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span>

    <span class="c1"># In case only 2 levels, i.e only one color to return</span>
    <span class="k">if</span> <span class="n">nc</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">split</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">levs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">levs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span>  <span class="c1"># Change of sign</span>
            <span class="k">return</span> <span class="n">white</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">colors</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

    <span class="c1"># Number of colors passed</span>
    <span class="n">ncols</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">colors</span><span class="p">)</span>

    <span class="n">col</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="c1"># Counts the number of negative colors</span>
    <span class="n">nn</span> <span class="o">=</span> <span class="mi">0</span>  <span class="c1"># initialize</span>
    <span class="c1"># if (mn&lt;=0.) and (levs[0]&lt;=-9.E19) : nn=nn+1 # Ext is one more &lt;0 box</span>
    <span class="n">zr</span> <span class="o">=</span> <span class="mi">0</span>  <span class="c1"># Counter to know if you stop by zero or it is included in a level</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nc</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">levs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mf">0.</span><span class="p">:</span>
            <span class="n">nn</span> <span class="o">=</span> <span class="n">nn</span> <span class="o">+</span> <span class="mi">1</span>  <span class="c1"># Count nb of &lt;0 box</span>
        <span class="k">if</span> <span class="n">levs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">==</span> <span class="mf">0.</span><span class="p">:</span>
            <span class="n">zr</span> <span class="o">=</span> <span class="mi">1</span>    <span class="c1"># Do we stop at zero ?</span>
    <span class="n">np</span> <span class="o">=</span> <span class="n">nc</span> <span class="o">-</span> <span class="n">nn</span>  <span class="c1"># Nb of &gt;0 box is tot - neg -1 for the blank box</span>

    <span class="k">if</span> <span class="n">mx</span> <span class="o">*</span> <span class="n">mn</span> <span class="o">&lt;</span> <span class="mf">0.</span> <span class="ow">and</span> <span class="n">zr</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">nn</span> <span class="o">=</span> <span class="n">nn</span> <span class="o">-</span> <span class="mi">1</span>  <span class="c1"># we have a split cell bet + and - so remove a -</span>
    <span class="c1"># Determine the interval (in colors) between each level</span>
    <span class="n">cinc</span> <span class="o">=</span> <span class="p">(</span><span class="n">ncols</span> <span class="o">-</span> <span class="mf">1.</span><span class="p">)</span> <span class="o">/</span> <span class="nb">float</span><span class="p">(</span><span class="n">nc</span> <span class="o">-</span> <span class="mf">1.</span><span class="p">)</span>

    <span class="c1"># Determine the interval (in colors) between each level (neg)</span>
    <span class="n">cincn</span> <span class="o">=</span> <span class="mf">0.</span>
    <span class="k">if</span> <span class="n">nn</span> <span class="o">!=</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">nn</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">cincn</span> <span class="o">=</span> <span class="p">(</span><span class="n">ncols</span> <span class="o">/</span> <span class="mf">2.</span> <span class="o">-</span> <span class="mf">1.</span><span class="p">)</span> <span class="o">/</span> <span class="nb">float</span><span class="p">(</span><span class="n">nn</span> <span class="o">-</span> <span class="mf">1.</span><span class="p">)</span>

    <span class="c1"># Determine the interval (in colors) between each level (pos)</span>
    <span class="n">cincp</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">isplit</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">if</span> <span class="n">np</span> <span class="o">!=</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">np</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">cincp</span> <span class="o">=</span> <span class="p">(</span><span class="n">ncols</span> <span class="o">/</span> <span class="mf">2.</span> <span class="o">-</span> <span class="mf">1.</span><span class="p">)</span> <span class="o">/</span> <span class="nb">float</span><span class="p">(</span><span class="n">np</span> <span class="o">-</span> <span class="mf">1.</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">sep</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">xrange</span><span class="p">(</span><span class="n">nc</span><span class="p">):</span>
            <span class="n">cv</span> <span class="o">=</span> <span class="n">i</span> <span class="o">*</span> <span class="n">cinc</span>
            <span class="n">col</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">colors</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">cv</span><span class="p">))])</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">col</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">xrange</span><span class="p">(</span><span class="n">nc</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">levs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">cv</span> <span class="o">=</span> <span class="n">i</span> <span class="o">*</span> <span class="n">cincn</span>
            <span class="c1"># if nn==1 : cv=len(colors)/4.   # if only 1 neg then use the</span>
            <span class="c1"># middle of the neg colors</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">levs</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="o">*</span> <span class="p">(</span><span class="n">levs</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">])</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">col</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">white</span><span class="p">)</span>
                    <span class="n">isplit</span> <span class="o">=</span> <span class="mi">1</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">col</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">colors</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">cv</span><span class="p">))])</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># if only 1 pos then use the middle of the pos colors</span>
                <span class="k">if</span> <span class="n">np</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="n">cv</span> <span class="o">=</span> <span class="mi">3</span> <span class="o">*</span> \
                        <span class="nb">len</span><span class="p">(</span><span class="n">colors</span><span class="p">)</span> <span class="o">/</span> \
                        <span class="mf">4.</span>
                <span class="n">cv</span> <span class="o">=</span> <span class="n">ncols</span> <span class="o">/</span> <span class="mf">2.</span> <span class="o">+</span> <span class="p">(</span><span class="n">i</span> <span class="o">-</span> <span class="n">nn</span> <span class="o">-</span> <span class="n">isplit</span><span class="p">)</span> <span class="o">*</span> <span class="n">cincp</span>
                <span class="n">col</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">colors</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">cv</span><span class="p">))])</span>
    <span class="k">if</span> <span class="n">col</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="n">white</span> <span class="ow">and</span> <span class="n">levs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;</span> <span class="o">-</span><span class="mf">9.E19</span><span class="p">:</span>
        <span class="n">col</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">colors</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">col</span></div>


<div class="viewcode-block" id="generate_time_labels"><a class="viewcode-back" href="../../vcs/misc/utils.html#vcs.utils.generate_time_labels">[docs]</a><span class="k">def</span> <span class="nf">generate_time_labels</span><span class="p">(</span><span class="n">d1</span><span class="p">,</span> <span class="n">d2</span><span class="p">,</span> <span class="n">units</span><span class="p">,</span> <span class="n">calendar</span><span class="o">=</span><span class="n">cdtime</span><span class="o">.</span><span class="n">DefaultCalendar</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Generates a dictionary of time labels for an interval of time,</span>
<span class="sd">    in a user defined units system.</span>

<span class="sd">    :Example:</span>

<span class="sd">        .. doctest:: generate_time_labels</span>

<span class="sd">            # Two ways to generate a dictionary of time labels</span>
<span class="sd">            &gt;&gt;&gt; lbls = generate_time_labels(cdtime.reltime(0,&#39;months since 2000&#39;),</span>
<span class="sd">            ...     cdtime.reltime(12,&#39;months since 2000&#39;),</span>
<span class="sd">            ...     &#39;days since 1800&#39;,) # for the year 2000 in units of &#39;days since 1800&#39;</span>
<span class="sd">            &gt;&gt;&gt; lbls = generate_time_labels(cdtime.reltime(0,&#39;months since 2000&#39;),</span>
<span class="sd">            ...     cdtime.comptime(2001),</span>
<span class="sd">            ...     &#39;days since 1800&#39;,) # for the year 2000 in units of &#39;days since 1800&#39;</span>
<span class="sd">            &gt;&gt;&gt; lbls = generate_time_labels(0, 12, &#39;months since 2000&#39;, ) # Generate a dictionary of time labels</span>
<span class="sd">                                                                        # for year 2000, units of &#39;months since 2000&#39;</span>


<span class="sd">    :param d1: The beginning of the time interval to be labelled. Expects a cdtime object.</span>
<span class="sd">                Can also take int, long, or float,</span>
<span class="sd">                which will be used to create a cdtime object with the given units parameter.</span>
<span class="sd">    :type d1: cdtime object, int, long, float</span>

<span class="sd">    :param d2: The end of the time interval to be labelled. Expects a cdtime object.</span>
<span class="sd">                Can also take int, long, or float,</span>
<span class="sd">                which will be used to create a cdtime object with the given units parameter.</span>
<span class="sd">    :type d2: cdtime object, int, long, float</span>

<span class="sd">    :param units: String with the format &#39;[time_unit] since [date]&#39;.</span>
<span class="sd">    :type units: str</span>

<span class="sd">    :param calendar: A cdtime calendar,</span>
<span class="sd">    :type calendar:</span>

<span class="sd">    :returns: Dictionary of time labels over the given time interval</span>
<span class="sd">    :rtype: dict</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">d1</span><span class="p">,</span> <span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="n">long</span><span class="p">,</span> <span class="nb">float</span><span class="p">)):</span>
        <span class="n">d1</span> <span class="o">=</span> <span class="n">cdtime</span><span class="o">.</span><span class="n">reltime</span><span class="p">(</span><span class="n">d1</span><span class="p">,</span> <span class="n">units</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">d2</span><span class="p">,</span> <span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="n">long</span><span class="p">,</span> <span class="nb">float</span><span class="p">)):</span>
        <span class="n">d2</span> <span class="o">=</span> <span class="n">cdtime</span><span class="o">.</span><span class="n">reltime</span><span class="p">(</span><span class="n">d2</span><span class="p">,</span> <span class="n">units</span><span class="p">)</span>
    <span class="n">d1r</span> <span class="o">=</span> <span class="n">d1</span><span class="o">.</span><span class="n">torel</span><span class="p">(</span><span class="n">units</span><span class="p">,</span> <span class="n">calendar</span><span class="p">)</span>
    <span class="n">d2r</span> <span class="o">=</span> <span class="n">d2</span><span class="o">.</span><span class="n">torel</span><span class="p">(</span><span class="n">units</span><span class="p">,</span> <span class="n">calendar</span><span class="p">)</span>
    <span class="n">d1</span><span class="p">,</span> <span class="n">d2</span> <span class="o">=</span> <span class="n">minmax</span><span class="p">(</span><span class="n">d1r</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="n">d2r</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>
    <span class="n">u</span> <span class="o">=</span> <span class="n">units</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;since&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
    <span class="n">dic</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">if</span> <span class="n">u</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;month&#39;</span><span class="p">,</span> <span class="s1">&#39;months&#39;</span><span class="p">]:</span>
        <span class="n">delta</span> <span class="o">=</span> <span class="p">(</span><span class="n">d2</span> <span class="o">-</span> <span class="n">d1</span><span class="p">)</span> <span class="o">*</span> <span class="mi">30</span>
    <span class="k">elif</span> <span class="n">u</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;year&#39;</span><span class="p">,</span> <span class="s1">&#39;years&#39;</span><span class="p">]:</span>
        <span class="n">delta</span> <span class="o">=</span> <span class="p">(</span><span class="n">d2</span> <span class="o">-</span> <span class="n">d1</span><span class="p">)</span> <span class="o">*</span> <span class="mi">365</span>
    <span class="k">elif</span> <span class="n">u</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;hours&#39;</span><span class="p">,</span> <span class="s1">&#39;hour&#39;</span><span class="p">]:</span>
        <span class="n">delta</span> <span class="o">=</span> <span class="p">(</span><span class="n">d2</span> <span class="o">-</span> <span class="n">d1</span><span class="p">)</span> <span class="o">/</span> <span class="mf">24.</span>
    <span class="k">elif</span> <span class="n">u</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;minute&#39;</span><span class="p">,</span> <span class="s1">&#39;minutes&#39;</span><span class="p">]:</span>
        <span class="n">delta</span> <span class="o">=</span> <span class="p">(</span><span class="n">d2</span> <span class="o">-</span> <span class="n">d1</span><span class="p">)</span> <span class="o">/</span> <span class="mf">24.</span> <span class="o">/</span> <span class="mf">60.</span>
    <span class="k">elif</span> <span class="n">u</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;second&#39;</span><span class="p">,</span> <span class="s1">&#39;seconds&#39;</span><span class="p">]:</span>
        <span class="n">delta</span> <span class="o">=</span> <span class="p">(</span><span class="n">d2</span> <span class="o">-</span> <span class="n">d1</span><span class="p">)</span> <span class="o">/</span> <span class="mf">24.</span> <span class="o">/</span> <span class="mf">60.</span> <span class="o">/</span> <span class="mf">60.</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">delta</span> <span class="o">=</span> <span class="n">d2</span> <span class="o">-</span> <span class="n">d1</span>
    <span class="k">if</span> <span class="n">delta</span> <span class="o">&lt;</span> <span class="o">.</span><span class="mi">042</span><span class="p">:</span>  <span class="c1"># less than 1 hour</span>
        <span class="n">levs</span> <span class="o">=</span> <span class="n">mkscale</span><span class="p">(</span><span class="n">d1</span><span class="p">,</span> <span class="n">d2</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="n">levs</span><span class="p">:</span>
            <span class="n">dic</span><span class="p">[</span><span class="n">l</span><span class="p">]</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">cdtime</span><span class="o">.</span><span class="n">reltime</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">units</span><span class="p">)</span><span class="o">.</span><span class="n">tocomp</span><span class="p">(</span><span class="n">calendar</span><span class="p">))</span>
    <span class="k">elif</span> <span class="n">delta</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">:</span>  <span class="c1"># Less than a day put a label every hours</span>
        <span class="n">d1</span> <span class="o">=</span> <span class="n">d1r</span><span class="o">.</span><span class="n">torel</span><span class="p">(</span><span class="s1">&#39;hours since 2000&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">value</span>
        <span class="n">d2</span> <span class="o">=</span> <span class="n">d2r</span><span class="o">.</span><span class="n">torel</span><span class="p">(</span><span class="s1">&#39;hours since 2000&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">value</span>
        <span class="n">d1</span><span class="p">,</span> <span class="n">d2</span> <span class="o">=</span> <span class="n">minmax</span><span class="p">(</span><span class="n">d1</span><span class="p">,</span> <span class="n">d2</span><span class="p">)</span>
        <span class="n">levs</span> <span class="o">=</span> <span class="n">mkscale</span><span class="p">(</span><span class="n">d1</span><span class="p">,</span> <span class="n">d2</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="n">levs</span><span class="p">:</span>
            <span class="n">t</span> <span class="o">=</span> <span class="n">cdtime</span><span class="o">.</span><span class="n">reltime</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="s1">&#39;hours since 2000&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">tocomp</span><span class="p">(</span><span class="n">calendar</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">t</span><span class="o">.</span><span class="n">minute</span> <span class="o">&gt;</span> <span class="mi">30</span><span class="p">:</span>
                <span class="n">t</span> <span class="o">=</span> <span class="n">t</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">cdtime</span><span class="o">.</span><span class="n">Hour</span><span class="p">)</span>
            <span class="n">t</span><span class="o">.</span><span class="n">minute</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="n">t</span><span class="o">.</span><span class="n">second</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="n">tr</span> <span class="o">=</span> <span class="n">t</span><span class="o">.</span><span class="n">torel</span><span class="p">(</span><span class="n">units</span><span class="p">,</span> <span class="n">calendar</span><span class="p">)</span>
            <span class="n">dic</span><span class="p">[</span><span class="n">tr</span><span class="o">.</span><span class="n">value</span><span class="p">]</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">t</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;:&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">elif</span> <span class="n">delta</span> <span class="o">&lt;</span> <span class="mi">90</span><span class="p">:</span>  <span class="c1"># Less than 3 month put label every day</span>
        <span class="n">d1</span> <span class="o">=</span> <span class="n">d1r</span><span class="o">.</span><span class="n">torel</span><span class="p">(</span><span class="s1">&#39;days since 2000&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">value</span>
        <span class="n">d2</span> <span class="o">=</span> <span class="n">d2r</span><span class="o">.</span><span class="n">torel</span><span class="p">(</span><span class="s1">&#39;days since 2000&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">value</span>
        <span class="n">d1</span><span class="p">,</span> <span class="n">d2</span> <span class="o">=</span> <span class="n">minmax</span><span class="p">(</span><span class="n">d1</span><span class="p">,</span> <span class="n">d2</span><span class="p">)</span>
        <span class="n">levs</span> <span class="o">=</span> <span class="n">mkscale</span><span class="p">(</span><span class="n">d1</span><span class="p">,</span> <span class="n">d2</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="n">levs</span><span class="p">:</span>
            <span class="n">t</span> <span class="o">=</span> <span class="n">cdtime</span><span class="o">.</span><span class="n">reltime</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="s1">&#39;days since 2000&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">tocomp</span><span class="p">(</span><span class="n">calendar</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">t</span><span class="o">.</span><span class="n">hour</span> <span class="o">&gt;</span> <span class="mi">12</span><span class="p">:</span>
                <span class="n">t</span> <span class="o">=</span> <span class="n">t</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">cdtime</span><span class="o">.</span><span class="n">Day</span><span class="p">)</span>
            <span class="n">t</span><span class="o">.</span><span class="n">hour</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="n">t</span><span class="o">.</span><span class="n">minute</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="n">t</span><span class="o">.</span><span class="n">second</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="n">tr</span> <span class="o">=</span> <span class="n">t</span><span class="o">.</span><span class="n">torel</span><span class="p">(</span><span class="n">units</span><span class="p">,</span> <span class="n">calendar</span><span class="p">)</span>
            <span class="n">dic</span><span class="p">[</span><span class="n">tr</span><span class="o">.</span><span class="n">value</span><span class="p">]</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">t</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">elif</span> <span class="n">delta</span> <span class="o">&lt;</span> <span class="mi">800</span><span class="p">:</span>  <span class="c1"># ~ Less than 24 month put label every month</span>
        <span class="n">d1</span> <span class="o">=</span> <span class="n">d1r</span><span class="o">.</span><span class="n">torel</span><span class="p">(</span><span class="s1">&#39;months since 2000&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">value</span>
        <span class="n">d2</span> <span class="o">=</span> <span class="n">d2r</span><span class="o">.</span><span class="n">torel</span><span class="p">(</span><span class="s1">&#39;months since 2000&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">value</span>
        <span class="n">d1</span><span class="p">,</span> <span class="n">d2</span> <span class="o">=</span> <span class="n">minmax</span><span class="p">(</span><span class="n">d1</span><span class="p">,</span> <span class="n">d2</span><span class="p">)</span>
        <span class="n">levs</span> <span class="o">=</span> <span class="n">mkscale</span><span class="p">(</span><span class="n">d1</span><span class="p">,</span> <span class="n">d2</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="n">levs</span><span class="p">:</span>
            <span class="n">t</span> <span class="o">=</span> <span class="n">cdtime</span><span class="o">.</span><span class="n">reltime</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="s1">&#39;months since 2000&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">tocomp</span><span class="p">(</span><span class="n">calendar</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">t</span><span class="o">.</span><span class="n">day</span> <span class="o">&gt;</span> <span class="mi">15</span><span class="p">:</span>
                <span class="n">t</span> <span class="o">=</span> <span class="n">t</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">cdtime</span><span class="o">.</span><span class="n">Month</span><span class="p">)</span>
            <span class="n">t</span><span class="o">.</span><span class="n">day</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="n">t</span><span class="o">.</span><span class="n">hour</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="n">t</span><span class="o">.</span><span class="n">minute</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="n">t</span><span class="o">.</span><span class="n">second</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="n">tr</span> <span class="o">=</span> <span class="n">t</span><span class="o">.</span><span class="n">torel</span><span class="p">(</span><span class="n">units</span><span class="p">,</span> <span class="n">calendar</span><span class="p">)</span>
            <span class="n">dic</span><span class="p">[</span><span class="n">tr</span><span class="o">.</span><span class="n">value</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;-&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">t</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;-&#39;</span><span class="p">)[:</span><span class="mi">2</span><span class="p">])</span>
    <span class="k">else</span><span class="p">:</span>  <span class="c1"># ok lots of years, let auto decide but always puts at Jan first</span>
        <span class="n">d1</span> <span class="o">=</span> <span class="n">d1r</span><span class="o">.</span><span class="n">torel</span><span class="p">(</span><span class="s1">&#39;years since 2000&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">value</span>
        <span class="n">d2</span> <span class="o">=</span> <span class="n">d2r</span><span class="o">.</span><span class="n">torel</span><span class="p">(</span><span class="s1">&#39;years since 2000&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">value</span>
        <span class="n">d1</span><span class="p">,</span> <span class="n">d2</span> <span class="o">=</span> <span class="n">minmax</span><span class="p">(</span><span class="n">d1</span><span class="p">,</span> <span class="n">d2</span><span class="p">)</span>
        <span class="n">levs</span> <span class="o">=</span> <span class="n">mkscale</span><span class="p">(</span><span class="n">d1</span><span class="p">,</span> <span class="n">d2</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="n">levs</span><span class="p">:</span>
            <span class="n">t</span> <span class="o">=</span> <span class="n">cdtime</span><span class="o">.</span><span class="n">reltime</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="s1">&#39;years since 2000&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">tocomp</span><span class="p">(</span><span class="n">calendar</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">t</span><span class="o">.</span><span class="n">month</span> <span class="o">&gt;</span> <span class="mi">6</span><span class="p">:</span>
                <span class="n">t</span> <span class="o">=</span> <span class="n">t</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">cdtime</span><span class="o">.</span><span class="n">Year</span><span class="p">)</span>
            <span class="n">t</span><span class="o">.</span><span class="n">month</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="n">t</span><span class="o">.</span><span class="n">day</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="n">t</span><span class="o">.</span><span class="n">hour</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="n">t</span><span class="o">.</span><span class="n">minute</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="n">t</span><span class="o">.</span><span class="n">second</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="n">tr</span> <span class="o">=</span> <span class="n">t</span><span class="o">.</span><span class="n">torel</span><span class="p">(</span><span class="n">units</span><span class="p">,</span> <span class="n">calendar</span><span class="p">)</span>
            <span class="n">dic</span><span class="p">[</span><span class="n">tr</span><span class="o">.</span><span class="n">value</span><span class="p">]</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">t</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;-&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">dic</span></div>


<span class="k">def</span> <span class="nf">prettifyAxisLabels</span><span class="p">(</span><span class="n">ticks</span><span class="p">,</span> <span class="n">axis</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">ticks</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">ticks</span><span class="p">[</span><span class="n">k</span><span class="p">])</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">continue</span>
        <span class="k">if</span> <span class="n">axis</span> <span class="o">==</span> <span class="s2">&quot;longitude&quot;</span><span class="p">:</span>
            <span class="n">K</span> <span class="o">=</span> <span class="n">k</span> <span class="o">%</span> <span class="mi">360</span>
            <span class="k">if</span> <span class="n">K</span> <span class="o">&gt;</span> <span class="mi">180</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">int</span><span class="p">(</span><span class="n">K</span><span class="p">)</span> <span class="o">==</span> <span class="nb">float</span><span class="p">(</span><span class="n">K</span><span class="p">):</span>
                    <span class="n">ticks</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">%i</span><span class="s2">W&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="mi">360</span> <span class="o">-</span> <span class="n">K</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">ticks</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">%.2f</span><span class="s2">W&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="mi">360</span> <span class="o">-</span> <span class="n">K</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">K</span> <span class="o">&lt;</span> <span class="mi">180</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">numpy</span><span class="o">.</span><span class="n">allclose</span><span class="p">(</span><span class="n">K</span><span class="p">,</span> <span class="mf">0.</span><span class="p">):</span>
                    <span class="n">ticks</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;0&quot;</span>
                <span class="k">elif</span> <span class="nb">int</span><span class="p">(</span><span class="n">K</span><span class="p">)</span> <span class="o">==</span> <span class="nb">float</span><span class="p">(</span><span class="n">K</span><span class="p">):</span>
                    <span class="n">ticks</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">%i</span><span class="s2">E&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">K</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">ticks</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">%.2f</span><span class="s2">E&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">K</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">k</span> <span class="o">==</span> <span class="o">-</span><span class="mf">180.</span><span class="p">:</span>
                    <span class="n">ticks</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;180W&quot;</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">ticks</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;180E&quot;</span>
        <span class="k">elif</span> <span class="n">axis</span> <span class="o">==</span> <span class="s2">&quot;latitude&quot;</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">k</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">ticks</span><span class="p">[</span><span class="n">k</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">4</span><span class="p">:</span>
                    <span class="n">ticks</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">%.1f</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="nb">eval</span><span class="p">(</span><span class="n">ticks</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="mi">1</span><span class="p">:])</span> <span class="o">+</span> <span class="s2">&quot;S&quot;</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">ticks</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">ticks</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="mi">1</span><span class="p">:]</span> <span class="o">+</span> <span class="s2">&quot;S&quot;</span>
            <span class="k">elif</span> <span class="n">k</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">ticks</span><span class="p">[</span><span class="n">k</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">4</span><span class="p">:</span>
                    <span class="n">ticks</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">%.1f</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="nb">eval</span><span class="p">(</span><span class="n">ticks</span><span class="p">[</span><span class="n">k</span><span class="p">])</span> <span class="o">+</span> <span class="s2">&quot;N&quot;</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">ticks</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">ticks</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">+</span> <span class="s2">&quot;N&quot;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">ticks</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;Eq&quot;</span>
    <span class="k">return</span> <span class="n">ticks</span>


<div class="viewcode-block" id="setTicksandLabels"><a class="viewcode-back" href="../../vcs/misc/utils.html#vcs.utils.setTicksandLabels">[docs]</a><span class="k">def</span> <span class="nf">setTicksandLabels</span><span class="p">(</span><span class="n">gm</span><span class="p">,</span> <span class="n">copy_gm</span><span class="p">,</span> <span class="n">datawc_x1</span><span class="p">,</span> <span class="n">datawc_x2</span><span class="p">,</span>
                      <span class="n">datawc_y1</span><span class="p">,</span> <span class="n">datawc_y2</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Sets the labels and ticks for a graphics method made in python</span>

<span class="sd">    :Example:</span>


<span class="sd">    :param gm: A VCS graphics method to alter</span>
<span class="sd">    :type gm: VCS graphics method</span>

<span class="sd">    :param copy_gm: A VCS graphics method object</span>
<span class="sd">    :type copy_gm: VCS graphics method</span>

<span class="sd">    :param datawc_x1: Float value to set the graphics method&#39;s datawc_x1 property to.</span>
<span class="sd">    :type datawc_x1: float</span>

<span class="sd">    :param datawc_x2: Float value to set the graphics method&#39;s datawc_x2 property to.</span>
<span class="sd">    :type datawc_x2: float</span>

<span class="sd">    :param datawc_y1: Float value to set the graphics method&#39;s datawc_y1 property to.</span>
<span class="sd">    :type datawc_y1: float</span>

<span class="sd">    :param datawc_y2: Float value to set the graphics method&#39;s datawc_y2 property to.</span>
<span class="sd">    :type datawc_y2: float</span>

<span class="sd">    :param x: If provided, must be the string &#39;longitude&#39;</span>
<span class="sd">    :type x: str</span>

<span class="sd">    :param y: If provided, must be the string &#39;latitude&#39;</span>
<span class="sd">    :type y: str</span>

<span class="sd">    :returns: A VCS graphics method object</span>
<span class="sd">    :rtype: A VCS graphics method object</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Ok all this is nice but if user specified datawc we need to use it!</span>
    <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;x1&quot;</span><span class="p">,</span> <span class="s2">&quot;x2&quot;</span><span class="p">,</span> <span class="s2">&quot;y1&quot;</span><span class="p">,</span> <span class="s2">&quot;y2&quot;</span><span class="p">]:</span>
        <span class="n">nm</span> <span class="o">=</span> <span class="s2">&quot;datawc_</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">a</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">numpy</span><span class="o">.</span><span class="n">allclose</span><span class="p">(</span><span class="nb">getattr</span><span class="p">(</span><span class="n">gm</span><span class="p">,</span> <span class="n">nm</span><span class="p">),</span> <span class="mf">1.e20</span><span class="p">):</span>
            <span class="n">exec</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2"> = gm.</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">nm</span><span class="p">,</span> <span class="n">nm</span><span class="p">))</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">gm</span><span class="p">,</span> <span class="n">vcs</span><span class="o">.</span><span class="n">taylor</span><span class="o">.</span><span class="n">Gtd</span><span class="p">):</span>
        <span class="k">return</span>
    <span class="c1"># Now the template stuff</span>
    <span class="c1"># first create the dictionary to remember which ones are changed</span>
    <span class="n">dic</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;xticlabels1&#39;</span><span class="p">,</span> <span class="s1">&#39;xmtics1&#39;</span><span class="p">,</span> <span class="s1">&#39;xticlabels2&#39;</span><span class="p">,</span> <span class="s1">&#39;xmtics2&#39;</span><span class="p">,</span>
              <span class="s1">&#39;yticlabels1&#39;</span><span class="p">,</span> <span class="s1">&#39;ymtics1&#39;</span><span class="p">,</span> <span class="s1">&#39;yticlabels2&#39;</span><span class="p">,</span> <span class="s1">&#39;ymtics2&#39;</span><span class="p">):</span>
        <span class="n">dic</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="c1"># xticklabels1</span>
    <span class="k">if</span> <span class="n">gm</span><span class="o">.</span><span class="n">xticlabels1</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">gm</span><span class="o">.</span><span class="n">xticlabels1</span> <span class="o">==</span> <span class="s1">&#39;*&#39;</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">copy_gm</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">copy_gm</span> <span class="o">=</span> <span class="n">creategraphicsmethod</span><span class="p">(</span><span class="n">gm</span><span class="o">.</span><span class="n">g_name</span><span class="p">,</span> <span class="n">gm</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
            <span class="n">gm</span> <span class="o">=</span> <span class="n">copy_gm</span>
        <span class="k">if</span> <span class="n">x</span> <span class="o">==</span> <span class="s2">&quot;longitude&quot;</span> <span class="ow">and</span> <span class="nb">abs</span><span class="p">(</span><span class="n">datawc_x2</span> <span class="o">-</span> <span class="n">datawc_x1</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">30</span><span class="p">:</span>
            <span class="n">ticks</span> <span class="o">=</span> <span class="s2">&quot;Lon30&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">ticks</span> <span class="o">=</span> <span class="n">vcs</span><span class="o">.</span><span class="n">mkscale</span><span class="p">(</span><span class="n">datawc_x1</span><span class="p">,</span> <span class="n">datawc_x2</span><span class="p">)</span>
            <span class="n">ticks</span> <span class="o">=</span> <span class="n">prettifyAxisLabels</span><span class="p">(</span><span class="n">vcs</span><span class="o">.</span><span class="n">mklabels</span><span class="p">(</span><span class="n">ticks</span><span class="p">),</span> <span class="n">x</span><span class="p">)</span>
        <span class="nb">setattr</span><span class="p">(</span><span class="n">gm</span><span class="p">,</span> <span class="s1">&#39;xticlabels1&#39;</span><span class="p">,</span> <span class="n">ticks</span><span class="p">)</span>
        <span class="n">dic</span><span class="p">[</span><span class="s1">&#39;xticlabels1&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="c1"># xmtics1</span>
    <span class="k">if</span> <span class="n">gm</span><span class="o">.</span><span class="n">xmtics1</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">gm</span><span class="o">.</span><span class="n">xmtics1</span> <span class="o">==</span> <span class="s1">&#39;*&#39;</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">copy_gm</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">copy_gm</span> <span class="o">=</span> <span class="n">creategraphicsmethod</span><span class="p">(</span><span class="n">gm</span><span class="o">.</span><span class="n">g_name</span><span class="p">,</span> <span class="n">gm</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
            <span class="n">gm</span> <span class="o">=</span> <span class="n">copy_gm</span>
        <span class="k">if</span> <span class="n">x</span> <span class="o">==</span> <span class="s2">&quot;longitude&quot;</span> <span class="ow">and</span> <span class="nb">abs</span><span class="p">(</span><span class="n">datawc_x2</span> <span class="o">-</span> <span class="n">datawc_x1</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">30</span><span class="p">:</span>
            <span class="n">ticks</span> <span class="o">=</span> <span class="n">gm</span><span class="o">.</span><span class="n">xticlabels1</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">ticks</span> <span class="o">=</span> <span class="n">vcs</span><span class="o">.</span><span class="n">mkscale</span><span class="p">(</span><span class="n">datawc_x1</span><span class="p">,</span> <span class="n">datawc_x2</span><span class="p">)</span>
        <span class="n">tick2</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">ticks</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
            <span class="n">tick2</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">ticks</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="n">ticks</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">])</span> <span class="o">/</span> <span class="mf">2.</span><span class="p">)</span>
        <span class="n">ticks</span> <span class="o">=</span> <span class="n">prettifyAxisLabels</span><span class="p">(</span><span class="n">vcs</span><span class="o">.</span><span class="n">mklabels</span><span class="p">(</span><span class="n">tick2</span><span class="p">),</span> <span class="n">x</span><span class="p">)</span>
        <span class="nb">setattr</span><span class="p">(</span><span class="n">gm</span><span class="p">,</span> <span class="s1">&#39;xmtics1&#39;</span><span class="p">,</span> <span class="n">ticks</span><span class="p">)</span>
        <span class="n">dic</span><span class="p">[</span><span class="s1">&#39;xmtics1&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="c1"># xticklabels2</span>
    <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">gm</span><span class="p">,</span> <span class="s2">&quot;xticlabels2&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span>
            <span class="n">gm</span><span class="o">.</span><span class="n">xticlabels2</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">gm</span><span class="o">.</span><span class="n">xticlabels2</span> <span class="o">==</span> <span class="s1">&#39;*&#39;</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">copy_gm</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">copy_gm</span> <span class="o">=</span> <span class="n">creategraphicsmethod</span><span class="p">(</span><span class="n">gm</span><span class="o">.</span><span class="n">g_name</span><span class="p">,</span> <span class="n">gm</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
            <span class="n">gm</span> <span class="o">=</span> <span class="n">copy_gm</span>
        <span class="k">if</span> <span class="n">x</span> <span class="o">==</span> <span class="s2">&quot;longitude&quot;</span> <span class="ow">and</span> <span class="nb">abs</span><span class="p">(</span><span class="n">datawc_x2</span> <span class="o">-</span> <span class="n">datawc_x1</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">30</span><span class="p">:</span>
            <span class="n">ticks</span> <span class="o">=</span> <span class="s2">&quot;Lon30&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">ticks</span> <span class="o">=</span> <span class="n">vcs</span><span class="o">.</span><span class="n">mkscale</span><span class="p">(</span><span class="n">datawc_x1</span><span class="p">,</span> <span class="n">datawc_x2</span><span class="p">)</span>
            <span class="n">ticks</span> <span class="o">=</span> <span class="n">prettifyAxisLabels</span><span class="p">(</span><span class="n">vcs</span><span class="o">.</span><span class="n">mklabels</span><span class="p">(</span><span class="n">ticks</span><span class="p">),</span> <span class="n">x</span><span class="p">)</span>
        <span class="nb">setattr</span><span class="p">(</span><span class="n">gm</span><span class="p">,</span> <span class="s1">&#39;xticlabels2&#39;</span><span class="p">,</span> <span class="n">ticks</span><span class="p">)</span>
        <span class="n">dic</span><span class="p">[</span><span class="s1">&#39;xticlabels2&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="c1"># xmtics2</span>
    <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">gm</span><span class="p">,</span> <span class="s2">&quot;xmtics2&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">gm</span><span class="o">.</span><span class="n">xmtics2</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">gm</span><span class="o">.</span><span class="n">xmtics2</span> <span class="o">==</span> <span class="s1">&#39;*&#39;</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">copy_gm</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">copy_gm</span> <span class="o">=</span> <span class="n">creategraphicsmethod</span><span class="p">(</span><span class="n">gm</span><span class="o">.</span><span class="n">g_name</span><span class="p">,</span> <span class="n">gm</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
            <span class="n">gm</span> <span class="o">=</span> <span class="n">copy_gm</span>
        <span class="k">if</span> <span class="n">x</span> <span class="o">==</span> <span class="s2">&quot;longitude&quot;</span> <span class="ow">and</span> <span class="nb">abs</span><span class="p">(</span><span class="n">datawc_x2</span> <span class="o">-</span> <span class="n">datawc_x1</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">30</span><span class="p">:</span>
            <span class="n">ticks</span> <span class="o">=</span> <span class="n">gm</span><span class="o">.</span><span class="n">xticlabels2</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">ticks</span> <span class="o">=</span> <span class="n">vcs</span><span class="o">.</span><span class="n">mkscale</span><span class="p">(</span><span class="n">datawc_x1</span><span class="p">,</span> <span class="n">datawc_x2</span><span class="p">)</span>
        <span class="n">tick2</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">ticks</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
            <span class="n">tick2</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">ticks</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="n">ticks</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">])</span> <span class="o">/</span> <span class="mf">2.</span><span class="p">)</span>
        <span class="n">ticks</span> <span class="o">=</span> <span class="n">prettifyAxisLabels</span><span class="p">(</span><span class="n">vcs</span><span class="o">.</span><span class="n">mklabels</span><span class="p">(</span><span class="n">tick2</span><span class="p">),</span> <span class="n">x</span><span class="p">)</span>
        <span class="nb">setattr</span><span class="p">(</span><span class="n">gm</span><span class="p">,</span> <span class="s1">&#39;xmtics2&#39;</span><span class="p">,</span> <span class="n">ticks</span><span class="p">)</span>
        <span class="n">dic</span><span class="p">[</span><span class="s1">&#39;xmtics2&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="c1"># yticklabels1</span>
    <span class="k">if</span> <span class="n">gm</span><span class="o">.</span><span class="n">yticlabels1</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">gm</span><span class="o">.</span><span class="n">yticlabels1</span> <span class="o">==</span> <span class="s1">&#39;*&#39;</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">copy_gm</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">copy_gm</span> <span class="o">=</span> <span class="n">creategraphicsmethod</span><span class="p">(</span><span class="n">gm</span><span class="o">.</span><span class="n">g_name</span><span class="p">,</span> <span class="n">gm</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
            <span class="n">gm</span> <span class="o">=</span> <span class="n">copy_gm</span>
        <span class="k">if</span> <span class="n">y</span> <span class="o">==</span> <span class="s2">&quot;latitude&quot;</span> <span class="ow">and</span> <span class="nb">abs</span><span class="p">(</span><span class="n">datawc_y2</span> <span class="o">-</span> <span class="n">datawc_y1</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">20</span><span class="p">:</span>
            <span class="n">ticks</span> <span class="o">=</span> <span class="s2">&quot;Lat20&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">ticks</span> <span class="o">=</span> <span class="n">vcs</span><span class="o">.</span><span class="n">mkscale</span><span class="p">(</span><span class="n">datawc_y1</span><span class="p">,</span> <span class="n">datawc_y2</span><span class="p">)</span>
            <span class="n">ticks</span> <span class="o">=</span> <span class="n">prettifyAxisLabels</span><span class="p">(</span><span class="n">vcs</span><span class="o">.</span><span class="n">mklabels</span><span class="p">(</span><span class="n">ticks</span><span class="p">),</span> <span class="n">y</span><span class="p">)</span>
        <span class="nb">setattr</span><span class="p">(</span><span class="n">gm</span><span class="p">,</span> <span class="s1">&#39;yticlabels1&#39;</span><span class="p">,</span> <span class="n">ticks</span><span class="p">)</span>
        <span class="n">dic</span><span class="p">[</span><span class="s1">&#39;yticlabels1&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="c1"># ymtics1</span>
    <span class="k">if</span> <span class="n">gm</span><span class="o">.</span><span class="n">ymtics1</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">gm</span><span class="o">.</span><span class="n">ymtics1</span> <span class="o">==</span> <span class="s1">&#39;*&#39;</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">copy_gm</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">copy_gm</span> <span class="o">=</span> <span class="n">creategraphicsmethod</span><span class="p">(</span><span class="n">gm</span><span class="o">.</span><span class="n">g_name</span><span class="p">,</span> <span class="n">gm</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
            <span class="n">gm</span> <span class="o">=</span> <span class="n">copy_gm</span>
        <span class="k">if</span> <span class="n">y</span> <span class="o">==</span> <span class="s2">&quot;latitude&quot;</span> <span class="ow">and</span> <span class="nb">abs</span><span class="p">(</span><span class="n">datawc_y2</span> <span class="o">-</span> <span class="n">datawc_y1</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">20</span><span class="p">:</span>
            <span class="n">ticks</span> <span class="o">=</span> <span class="n">gm</span><span class="o">.</span><span class="n">yticlabels1</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">ticks</span> <span class="o">=</span> <span class="n">vcs</span><span class="o">.</span><span class="n">mkscale</span><span class="p">(</span><span class="n">datawc_y1</span><span class="p">,</span> <span class="n">datawc_y2</span><span class="p">)</span>
        <span class="n">tick2</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">ticks</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
            <span class="n">tick2</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">ticks</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="n">ticks</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">])</span> <span class="o">/</span> <span class="mf">2.</span><span class="p">)</span>
        <span class="n">ticks</span> <span class="o">=</span> <span class="n">prettifyAxisLabels</span><span class="p">(</span><span class="n">vcs</span><span class="o">.</span><span class="n">mklabels</span><span class="p">(</span><span class="n">tick2</span><span class="p">),</span> <span class="n">y</span><span class="p">)</span>
        <span class="nb">setattr</span><span class="p">(</span><span class="n">gm</span><span class="p">,</span> <span class="s1">&#39;ymtics1&#39;</span><span class="p">,</span> <span class="n">ticks</span><span class="p">)</span>
        <span class="n">dic</span><span class="p">[</span><span class="s1">&#39;ymtics1&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="c1"># yticklabels2</span>
    <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">gm</span><span class="p">,</span> <span class="s2">&quot;yticlabels2&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span>
            <span class="n">gm</span><span class="o">.</span><span class="n">yticlabels2</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">gm</span><span class="o">.</span><span class="n">yticlabels2</span> <span class="o">==</span> <span class="s1">&#39;*&#39;</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">copy_gm</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">copy_gm</span> <span class="o">=</span> <span class="n">creategraphicsmethod</span><span class="p">(</span><span class="n">gm</span><span class="o">.</span><span class="n">g_name</span><span class="p">,</span> <span class="n">gm</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
            <span class="n">gm</span> <span class="o">=</span> <span class="n">copy_gm</span>
        <span class="k">if</span> <span class="n">y</span> <span class="o">==</span> <span class="s2">&quot;latitude&quot;</span> <span class="ow">and</span> <span class="nb">abs</span><span class="p">(</span><span class="n">datawc_y2</span> <span class="o">-</span> <span class="n">datawc_y1</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">20</span><span class="p">:</span>
            <span class="n">ticks</span> <span class="o">=</span> <span class="s2">&quot;Lat20&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">ticks</span> <span class="o">=</span> <span class="n">vcs</span><span class="o">.</span><span class="n">mkscale</span><span class="p">(</span><span class="n">datawc_y1</span><span class="p">,</span> <span class="n">datawc_y2</span><span class="p">)</span>
            <span class="n">ticks</span> <span class="o">=</span> <span class="n">prettifyAxisLabels</span><span class="p">(</span><span class="n">vcs</span><span class="o">.</span><span class="n">mklabels</span><span class="p">(</span><span class="n">ticks</span><span class="p">),</span> <span class="n">y</span><span class="p">)</span>
        <span class="nb">setattr</span><span class="p">(</span><span class="n">gm</span><span class="p">,</span> <span class="s1">&#39;yticlabels2&#39;</span><span class="p">,</span> <span class="n">ticks</span><span class="p">)</span>
        <span class="n">dic</span><span class="p">[</span><span class="s1">&#39;yticlabels2&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="c1"># ymtics2</span>
    <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">gm</span><span class="p">,</span> <span class="s2">&quot;ymtics2&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">gm</span><span class="o">.</span><span class="n">ymtics2</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">gm</span><span class="o">.</span><span class="n">ymtics2</span> <span class="o">==</span> <span class="s1">&#39;*&#39;</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">copy_gm</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">copy_gm</span> <span class="o">=</span> <span class="n">creategraphicsmethod</span><span class="p">(</span><span class="n">gm</span><span class="o">.</span><span class="n">g_name</span><span class="p">,</span> <span class="n">gm</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
            <span class="n">gm</span> <span class="o">=</span> <span class="n">copy_gm</span>
        <span class="k">if</span> <span class="n">y</span> <span class="o">==</span> <span class="s2">&quot;latitude&quot;</span> <span class="ow">and</span> <span class="nb">abs</span><span class="p">(</span><span class="n">datawc_y2</span> <span class="o">-</span> <span class="n">datawc_y1</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">20</span><span class="p">:</span>
            <span class="n">ticks</span> <span class="o">=</span> <span class="n">gm</span><span class="o">.</span><span class="n">yticlabels2</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">ticks</span> <span class="o">=</span> <span class="n">vcs</span><span class="o">.</span><span class="n">mkscale</span><span class="p">(</span><span class="n">datawc_y1</span><span class="p">,</span> <span class="n">datawc_y2</span><span class="p">)</span>
        <span class="n">tick2</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">ticks</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
            <span class="n">tick2</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">ticks</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="n">ticks</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">])</span> <span class="o">/</span> <span class="mf">2.</span><span class="p">)</span>
        <span class="n">ticks</span> <span class="o">=</span> <span class="n">prettifyAxisLabels</span><span class="p">(</span><span class="n">vcs</span><span class="o">.</span><span class="n">mklabels</span><span class="p">(</span><span class="n">tick2</span><span class="p">),</span> <span class="n">y</span><span class="p">)</span>
        <span class="nb">setattr</span><span class="p">(</span><span class="n">gm</span><span class="p">,</span> <span class="s1">&#39;ymtics2&#39;</span><span class="p">,</span> <span class="n">ticks</span><span class="p">)</span>
        <span class="n">dic</span><span class="p">[</span><span class="s1">&#39;ymtics2&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="k">return</span> <span class="n">copy_gm</span></div>


<div class="viewcode-block" id="getcolormap"><a class="viewcode-back" href="../../vcs/misc/utils.html#vcs.utils.getcolormap">[docs]</a><span class="k">def</span> <span class="nf">getcolormap</span><span class="p">(</span><span class="n">Cp_name_src</span><span class="o">=</span><span class="s1">&#39;default&#39;</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    VCS contains a list of secondary methods. This function will create a</span>
<span class="sd">    colormap class object from an existing VCS colormap secondary method. If</span>
<span class="sd">    no colormap name is given, then colormap &#39;default&#39; will be used.</span>

<span class="sd">    .. note::</span>

<span class="sd">        VCS does not allow the modification of &#39;default&#39; attribute sets.</span>
<span class="sd">        However, a &#39;default&#39; attribute set that has been copied under a</span>
<span class="sd">        different name can be modified. (See the createcolormap function.)</span>

<span class="sd">    :Example:</span>

<span class="sd">        .. doctest:: utils_getcolormap</span>

<span class="sd">            &gt;&gt;&gt; a=vcs.init()</span>
<span class="sd">            &gt;&gt;&gt; a.show(&#39;colormap&#39;) # Show all the existing colormap secondary methods</span>
<span class="sd">            *******************Colormap Names List**********************</span>
<span class="sd">            ...</span>
<span class="sd">            *******************End Colormap Names List**********************</span>
<span class="sd">            &gt;&gt;&gt; cp=a.getcolormap() # cp instance of &#39;default&#39; colormap secondary method</span>
<span class="sd">            &gt;&gt;&gt; cp2=a.getcolormap(&#39;rainbow&#39;) # cp2 instance of existing &#39;rainbow&#39; colormap secondary method</span>


<span class="sd">    :param Cp_name_src: String name of an existing colormap VCS object</span>
<span class="sd">    :type Cp_name_src: str</span>

<span class="sd">    :returns: A pre-existing VCS colormap object</span>
<span class="sd">    :rtype: vcs.colormap.Cp</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Check to make sure the argument passed in is a STRING</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">Cp_name_src</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Error -  The argument must be a string.&#39;</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">vcs</span><span class="o">.</span><span class="n">elements</span><span class="p">[</span><span class="s2">&quot;colormap&quot;</span><span class="p">][</span><span class="n">Cp_name_src</span><span class="p">]</span></div>


<div class="viewcode-block" id="getcolorcell"><a class="viewcode-back" href="../../vcs/misc/utils.html#vcs.utils.getcolorcell">[docs]</a><span class="k">def</span> <span class="nf">getcolorcell</span><span class="p">(</span><span class="n">cell</span><span class="p">,</span> <span class="n">obj</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Gets the colorcell of the provided object&#39;s colormap at the specified cell index.</span>
<span class="sd">    If no object is provided, or if the provided object has no colormap, the default colormap is used.</span>

<span class="sd">    :Example:</span>

<span class="sd">        .. doctest:: utils_getcolorcell</span>

<span class="sd">            &gt;&gt;&gt; a=vcs.init()</span>
<span class="sd">            &gt;&gt;&gt; b=vcs.createboxfill()</span>
<span class="sd">            &gt;&gt;&gt; b.colormap=&#39;rainbow&#39;</span>
<span class="sd">            &gt;&gt;&gt; a.getcolorcell(2,b)</span>
<span class="sd">            [85, 85, 85, 100.0]</span>

<span class="sd">    :param cell: An integer value indicating the index of the desired colorcell.</span>
<span class="sd">    :type cell: int</span>

<span class="sd">    :param obj: Optional parameter containing the object to extract a colormap from.</span>
<span class="sd">    :type obj: Any VCS object capable of containing a colormap</span>

<span class="sd">    :return: The RGBA values of the colormap at the specified cell index.</span>
<span class="sd">    :rtype: list</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">obj</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">cmap</span> <span class="o">=</span> <span class="n">vcs</span><span class="o">.</span><span class="n">getcolormap</span><span class="p">()</span>
    <span class="k">elif</span> <span class="n">obj</span><span class="o">.</span><span class="n">colormap</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">cmap</span> <span class="o">=</span> <span class="n">vcs</span><span class="o">.</span><span class="n">getcolormap</span><span class="p">()</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">cmap</span> <span class="o">=</span> <span class="n">vcs</span><span class="o">.</span><span class="n">getcolormap</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">colormap</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">cmap</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="n">cell</span><span class="p">]</span></div>


<div class="viewcode-block" id="setcolorcell"><a class="viewcode-back" href="../../vcs/misc/utils.html#vcs.utils.setcolorcell">[docs]</a><span class="k">def</span> <span class="nf">setcolorcell</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">num</span><span class="p">,</span> <span class="n">r</span><span class="p">,</span> <span class="n">g</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">a</span><span class="o">=</span><span class="mi">100</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Set a individual color cell in the active colormap. If default is</span>
<span class="sd">    the active colormap, then return an error string.</span>

<span class="sd">    .. note::</span>

<span class="sd">        If the the visual display is 16-bit, 24-bit, or 32-bit TrueColor,</span>
<span class="sd">        then a redrawing</span>
<span class="sd">        of the VCS Canvas is made every time the color cell is changed.</span>

<span class="sd">    :Example:</span>

<span class="sd">        .. doctest:: utils_setcolorcell</span>

<span class="sd">            &gt;&gt;&gt; vcs.setcolorcell(&quot;AMIP&quot;,11,0,0,0)</span>
<span class="sd">            &gt;&gt;&gt; vcs.setcolorcell(&quot;AMIP&quot;,21,100,0,0)</span>
<span class="sd">            &gt;&gt;&gt; vcs.setcolorcell(&quot;AMIP&quot;,31,0,100,0)</span>
<span class="sd">            &gt;&gt;&gt; vcs.setcolorcell(&quot;AMIP&quot;,41,0,0,100)</span>
<span class="sd">            &gt;&gt;&gt; vcs.setcolorcell(&quot;AMIP&quot;,51,100,100,100)</span>
<span class="sd">            &gt;&gt;&gt; vcs.setcolorcell(&quot;AMIP&quot;,61,70,70,70)</span>

<span class="sd">    :param obj: String name of a colormap, or a VCS object</span>
<span class="sd">    :type obj: str or VCS object</span>

<span class="sd">    :param num: Integer specifying which color cell to change. Must be from 0-239.</span>
<span class="sd">    :type num: int</span>

<span class="sd">    :param r: Integer specifying the red value for the colorcell</span>
<span class="sd">    :type r: int</span>

<span class="sd">    :param g: Integer specifying the green value for the colorcell</span>
<span class="sd">    :type g: int</span>

<span class="sd">    :param b: Integer specifying the blue value for the colorcell</span>
<span class="sd">    :type b: int</span>

<span class="sd">    :param a: Integer specifying the opacity value for the colorcell. Must be from 0-100.</span>
<span class="sd">    :type a: int</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
        <span class="n">cmap</span> <span class="o">=</span> <span class="n">getcolormap</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">cmap</span> <span class="o">=</span> <span class="n">getcolormap</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">colormap</span><span class="p">)</span>
    <span class="n">cmap</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="n">num</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="n">g</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">a</span><span class="p">)</span>

    <span class="k">return</span></div>


<div class="viewcode-block" id="match_color"><a class="viewcode-back" href="../../vcs/misc/utils.html#vcs.utils.match_color">[docs]</a><span class="k">def</span> <span class="nf">match_color</span><span class="p">(</span><span class="n">color</span><span class="p">,</span> <span class="n">colormap</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Returns the color in the colormap that is</span>
<span class="sd">    closest to the required color.</span>

<span class="sd">    :Example:</span>

<span class="sd">        .. doctest:: utils_match_color</span>

<span class="sd">            &gt;&gt;&gt; a=vcs.init()</span>
<span class="sd">            &gt;&gt;&gt; print vcs.match_color(&#39;salmon&#39;)</span>
<span class="sd">            &gt;&gt;&gt; print vcs.match_color(&#39;red&#39;)</span>
<span class="sd">            &gt;&gt;&gt; print vcs.match_color([0,0,100],&#39;default&#39;) # closest color from blue</span>

<span class="sd">    :param color: Either a string name, or a rgb value between 0 and 100.</span>
<span class="sd">    :type color: str, int</span>

<span class="sd">    :param colormap: A VCS colormap object. If not specified, the default colormap is used.</span>
<span class="sd">    :type colormap: vcs.colormap.Cp</span>

<span class="sd">    :returns: Integer value representing a matching rgb color</span>
<span class="sd">    :rtype: int</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># First gets the rgb values</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">color</span><span class="p">,</span> <span class="nb">type</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)):</span>
        <span class="n">vals</span> <span class="o">=</span> <span class="n">genutil</span><span class="o">.</span><span class="n">colors</span><span class="o">.</span><span class="n">str2rgb</span><span class="p">(</span><span class="n">color</span><span class="p">)</span>
        <span class="n">vals</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">/=</span> <span class="mf">2.55</span>
        <span class="n">vals</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">/=</span> <span class="mf">2.55</span>
        <span class="n">vals</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">/=</span> <span class="mf">2.55</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">vals</span> <span class="o">=</span> <span class="n">color</span>

    <span class="c1"># Now gets the colormap to look in</span>
    <span class="k">if</span> <span class="n">colormap</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">colormap</span> <span class="o">=</span> <span class="n">vcs</span><span class="o">.</span><span class="n">getcolormapname</span><span class="p">()</span>
    <span class="n">cmap</span> <span class="o">=</span> <span class="n">vcs</span><span class="o">.</span><span class="n">getcolormap</span><span class="p">(</span><span class="n">colormap</span><span class="p">)</span>

    <span class="c1"># Now tries determines the min rms diff</span>
    <span class="n">rmsmin</span> <span class="o">=</span> <span class="mf">2.E40</span>
    <span class="n">match</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">cmap</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
        <span class="n">col</span> <span class="o">=</span> <span class="n">cmap</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
        <span class="n">rms</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">sqrt</span><span class="p">((</span><span class="n">vals</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">col</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">+</span>
                         <span class="p">(</span><span class="n">vals</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">col</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">+</span>
                         <span class="p">(</span><span class="n">vals</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">-</span> <span class="n">col</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span> <span class="o">**</span> <span class="mi">2</span>
                         <span class="p">)</span>
        <span class="k">if</span> <span class="n">rms</span> <span class="o">&lt;</span> <span class="n">rmsmin</span><span class="p">:</span>
            <span class="n">rmsmin</span> <span class="o">=</span> <span class="n">rms</span>
            <span class="n">match</span> <span class="o">=</span> <span class="n">i</span>
    <span class="k">return</span> <span class="n">match</span></div>


<span class="k">def</span> <span class="nf">monotonic</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
    <span class="n">dx</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">numpy</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">dx</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">)</span> <span class="ow">or</span> <span class="n">numpy</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">dx</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">getgraphicsmethod</span><span class="p">(</span><span class="nb">type</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
    <span class="kn">import</span> <span class="nn">vcsaddons</span>
    <span class="k">if</span> <span class="nb">type</span> <span class="o">==</span> <span class="s2">&quot;default&quot;</span><span class="p">:</span>
        <span class="nb">type</span> <span class="o">=</span> <span class="s2">&quot;boxfill&quot;</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="nb">type</span><span class="p">,</span> <span class="n">vcsaddons</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">VCSaddon</span><span class="p">):</span>
        <span class="n">func</span> <span class="o">=</span> <span class="nb">type</span><span class="o">.</span><span class="n">getgm</span>
        <span class="n">copy_mthd</span> <span class="o">=</span> <span class="n">func</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">copy_mthd</span> <span class="o">=</span> <span class="n">vcs</span><span class="o">.</span><span class="n">elements</span><span class="p">[</span><span class="nb">type</span><span class="p">][</span><span class="n">name</span><span class="p">]</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="n">copy_mthd</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">return</span> <span class="n">copy_mthd</span>


<span class="k">def</span> <span class="nf">creategraphicsmethod</span><span class="p">(</span><span class="n">gtype</span><span class="p">,</span> <span class="n">gname</span><span class="o">=</span><span class="s1">&#39;default&#39;</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="kn">import</span> <span class="nn">vcsaddons</span>
    <span class="k">if</span> <span class="n">gtype</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;isoline&#39;</span><span class="p">,</span> <span class="s1">&#39;Gi&#39;</span><span class="p">]:</span>
        <span class="n">func</span> <span class="o">=</span> <span class="n">vcs</span><span class="o">.</span><span class="n">createisoline</span>
    <span class="k">elif</span> <span class="n">gtype</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;isofill&#39;</span><span class="p">,</span> <span class="s1">&#39;Gfi&#39;</span><span class="p">]:</span>
        <span class="n">func</span> <span class="o">=</span> <span class="n">vcs</span><span class="o">.</span><span class="n">createisofill</span>
    <span class="k">elif</span> <span class="n">gtype</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;boxfill&#39;</span><span class="p">,</span> <span class="s1">&#39;default&#39;</span><span class="p">]:</span>
        <span class="n">func</span> <span class="o">=</span> <span class="n">vcs</span><span class="o">.</span><span class="n">createboxfill</span>
    <span class="k">elif</span> <span class="n">gtype</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;meshfill&#39;</span><span class="p">,</span> <span class="s1">&#39;Gfm&#39;</span><span class="p">]:</span>
        <span class="n">func</span> <span class="o">=</span> <span class="n">vcs</span><span class="o">.</span><span class="n">createmeshfill</span>
    <span class="k">elif</span> <span class="n">gtype</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;scatter&#39;</span><span class="p">,</span> <span class="p">]:</span>
        <span class="n">func</span> <span class="o">=</span> <span class="n">vcs</span><span class="o">.</span><span class="n">createscatter</span>
    <span class="k">elif</span> <span class="n">gtype</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;xvsy&#39;</span><span class="p">,</span> <span class="p">]:</span>
        <span class="n">func</span> <span class="o">=</span> <span class="n">vcs</span><span class="o">.</span><span class="n">createxvsy</span>
    <span class="k">elif</span> <span class="n">gtype</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;xyvsy&#39;</span><span class="p">,</span> <span class="p">]:</span>
        <span class="n">func</span> <span class="o">=</span> <span class="n">vcs</span><span class="o">.</span><span class="n">createxyvsy</span>
    <span class="k">elif</span> <span class="n">gtype</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;yxvsx&#39;</span><span class="p">,</span> <span class="p">]:</span>
        <span class="n">func</span> <span class="o">=</span> <span class="n">vcs</span><span class="o">.</span><span class="n">createyxvsx</span>
    <span class="k">elif</span> <span class="n">gtype</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;1d&#39;</span><span class="p">,</span> <span class="s1">&#39;G1d&#39;</span><span class="p">]:</span>
        <span class="n">func</span> <span class="o">=</span> <span class="n">vcs</span><span class="o">.</span><span class="n">create1d</span>
    <span class="k">elif</span> <span class="n">gtype</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;vector&#39;</span><span class="p">,</span> <span class="s1">&#39;Gv&#39;</span><span class="p">]:</span>
        <span class="n">func</span> <span class="o">=</span> <span class="n">vcs</span><span class="o">.</span><span class="n">createvector</span>
    <span class="k">elif</span> <span class="n">gtype</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;taylordiagram&#39;</span><span class="p">,</span> <span class="s1">&#39;Gtd&#39;</span><span class="p">]:</span>
        <span class="n">func</span> <span class="o">=</span> <span class="n">vcs</span><span class="o">.</span><span class="n">createtaylordiagram</span>
    <span class="k">elif</span> <span class="n">gtype</span> <span class="o">==</span> <span class="s1">&#39;3d_scalar&#39;</span><span class="p">:</span>
        <span class="n">func</span> <span class="o">=</span> <span class="n">vcs</span><span class="o">.</span><span class="n">create3d_scalar</span>
    <span class="k">elif</span> <span class="n">gtype</span> <span class="o">==</span> <span class="s1">&#39;3d_dual_scalar&#39;</span><span class="p">:</span>
        <span class="n">func</span> <span class="o">=</span> <span class="n">vcs</span><span class="o">.</span><span class="n">create3d_dual_scalar</span>
    <span class="k">elif</span> <span class="n">gtype</span> <span class="o">==</span> <span class="s1">&#39;3d_vector&#39;</span><span class="p">:</span>
        <span class="n">func</span> <span class="o">=</span> <span class="n">vcs</span><span class="o">.</span><span class="n">create3d_vector</span>
    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">gtype</span><span class="p">,</span> <span class="n">vcsaddons</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">VCSaddon</span><span class="p">):</span>
        <span class="n">func</span> <span class="o">=</span> <span class="n">gtype</span><span class="o">.</span><span class="n">creategm</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">None</span>
    <span class="n">copy_mthd</span> <span class="o">=</span> <span class="n">func</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span> <span class="n">source</span><span class="o">=</span><span class="n">gname</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">copy_mthd</span>


<span class="c1"># Returns the float value for datawc_...</span>
<span class="c1"># datawc_ can be a float or a cdtime.reltime</span>
<span class="c1"># TODO: Investigate why datawc is converted to a cdtime.reltime</span>
<span class="k">def</span> <span class="nf">getDataWcValue</span><span class="p">(</span><span class="n">v</span><span class="p">):</span>
    <span class="k">if</span> <span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">type</span><span class="p">(</span><span class="n">cdtime</span><span class="o">.</span><span class="n">reltime</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;months since 1900&#39;</span><span class="p">))):</span>  <span class="c1"># noqa</span>
        <span class="k">return</span> <span class="n">v</span><span class="o">.</span><span class="n">value</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">v</span>


<div class="viewcode-block" id="getworldcoordinates"><a class="viewcode-back" href="../../vcs/misc/utils.html#vcs.utils.getworldcoordinates">[docs]</a><span class="k">def</span> <span class="nf">getworldcoordinates</span><span class="p">(</span><span class="n">gm</span><span class="p">,</span> <span class="n">X</span><span class="p">,</span> <span class="n">Y</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Given a graphics method and two axes</span>
<span class="sd">    figures out correct world coordinates.</span>

<span class="sd">    :param gm: A VCS graphics method object to get worldcoordinates for.</span>
<span class="sd">    :type gm: graphics method object</span>

<span class="sd">    :param X: A cdms2 transient axs</span>
<span class="sd">    :type X: cdms2 transient axis</span>

<span class="sd">    :param Y: A cdms2 transient axs</span>
<span class="sd">    :type Y: cdms2 transient axis</span>

<span class="sd">    :returns:</span>
<span class="sd">    :rtype:</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># compute the spanning in x and y, and adjust for the viewport</span>
    <span class="n">wc</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">datawc</span> <span class="o">=</span> <span class="p">[</span><span class="n">getDataWcValue</span><span class="p">(</span><span class="n">gm</span><span class="o">.</span><span class="n">datawc_x1</span><span class="p">),</span> <span class="n">getDataWcValue</span><span class="p">(</span><span class="n">gm</span><span class="o">.</span><span class="n">datawc_x2</span><span class="p">),</span>
                  <span class="n">getDataWcValue</span><span class="p">(</span><span class="n">gm</span><span class="o">.</span><span class="n">datawc_y1</span><span class="p">),</span> <span class="n">getDataWcValue</span><span class="p">(</span><span class="n">gm</span><span class="o">.</span><span class="n">datawc_y2</span><span class="p">)]</span>
        <span class="k">if</span> <span class="n">numpy</span><span class="o">.</span><span class="n">isclose</span><span class="p">(</span><span class="n">datawc</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mf">1.e20</span><span class="p">):</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="k">while</span> <span class="n">X</span><span class="p">[:][</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">count</span><span class="p">()</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                        <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="k">except</span><span class="p">:</span>
                    <span class="k">pass</span>
                <span class="n">wc</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">X</span><span class="p">[:][</span><span class="n">i</span><span class="p">]</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="n">wc</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">X</span><span class="p">[:]</span><span class="o">.</span><span class="n">min</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">wc</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">datawc</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">numpy</span><span class="o">.</span><span class="n">isclose</span><span class="p">(</span><span class="n">datawc</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="mf">1.e20</span><span class="p">):</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">i</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="k">while</span> <span class="n">X</span><span class="p">[:][</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">count</span><span class="p">()</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                        <span class="n">i</span> <span class="o">-=</span> <span class="mi">1</span>
                <span class="k">except</span><span class="p">:</span>
                    <span class="k">pass</span>
                <span class="n">wc</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">X</span><span class="p">[:][</span><span class="n">i</span><span class="p">]</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="n">wc</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">X</span><span class="p">[:]</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">wc</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">datawc</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">wc</span>
    <span class="k">if</span> <span class="p">(((</span><span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">cdms2</span><span class="o">.</span><span class="n">axis</span><span class="o">.</span><span class="n">TransientAxis</span><span class="p">)</span> <span class="ow">and</span>
          <span class="nb">isinstance</span><span class="p">(</span><span class="n">Y</span><span class="p">,</span> <span class="n">cdms2</span><span class="o">.</span><span class="n">axis</span><span class="o">.</span><span class="n">TransientAxis</span><span class="p">))</span> <span class="ow">or</span>
         <span class="ow">not</span> <span class="n">vcs</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">monotonic</span><span class="p">(</span><span class="n">X</span><span class="p">[:]))</span> <span class="ow">and</span>
        <span class="n">numpy</span><span class="o">.</span><span class="n">allclose</span><span class="p">([</span><span class="n">datawc</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">datawc</span><span class="p">[</span><span class="mi">1</span><span class="p">]],</span> <span class="mf">1.e20</span><span class="p">))</span>\
            <span class="ow">or</span> <span class="p">(</span><span class="nb">hasattr</span><span class="p">(</span><span class="n">gm</span><span class="p">,</span> <span class="s2">&quot;projection&quot;</span><span class="p">)</span> <span class="ow">and</span>
                <span class="n">vcs</span><span class="o">.</span><span class="n">elements</span><span class="p">[</span><span class="s2">&quot;projection&quot;</span><span class="p">][</span><span class="n">gm</span><span class="o">.</span><span class="n">projection</span><span class="p">]</span><span class="o">.</span><span class="n">type</span> <span class="o">!=</span> <span class="s2">&quot;linear&quot;</span><span class="p">):</span>
        <span class="n">wc</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">X</span><span class="p">[:]</span><span class="o">.</span><span class="n">min</span><span class="p">()</span>
        <span class="n">wc</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">X</span><span class="p">[:]</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">numpy</span><span class="o">.</span><span class="n">isclose</span><span class="p">(</span><span class="n">datawc</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="mf">1.e20</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">while</span> <span class="n">Y</span><span class="p">[:][</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">count</span><span class="p">()</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
                <span class="k">pass</span>
            <span class="n">wc</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">Y</span><span class="p">[:][</span><span class="n">i</span><span class="p">]</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="n">wc</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">Y</span><span class="p">[:]</span><span class="o">.</span><span class="n">min</span><span class="p">()</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">wc</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">datawc</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">numpy</span><span class="o">.</span><span class="n">isclose</span><span class="p">(</span><span class="n">datawc</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="mf">1.e20</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">i</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">while</span> <span class="n">Y</span><span class="p">[:][</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">count</span><span class="p">()</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">i</span> <span class="o">-=</span> <span class="mi">1</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="k">pass</span>
            <span class="n">wc</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="n">Y</span><span class="p">[:][</span><span class="n">i</span><span class="p">]</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="n">wc</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="n">Y</span><span class="p">[:]</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">wc</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="n">datawc</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>
    <span class="k">if</span> <span class="p">(((</span><span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">Y</span><span class="p">,</span> <span class="n">cdms2</span><span class="o">.</span><span class="n">axis</span><span class="o">.</span><span class="n">TransientAxis</span><span class="p">)</span> <span class="ow">and</span>
          <span class="nb">isinstance</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">cdms2</span><span class="o">.</span><span class="n">axis</span><span class="o">.</span><span class="n">TransientAxis</span><span class="p">))</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">vcs</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">monotonic</span><span class="p">(</span><span class="n">Y</span><span class="p">[:]))</span> <span class="ow">and</span>
        <span class="n">numpy</span><span class="o">.</span><span class="n">allclose</span><span class="p">([</span><span class="n">datawc</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">datawc</span><span class="p">[</span><span class="mi">3</span><span class="p">]],</span> <span class="mf">1.e20</span><span class="p">))</span> \
            <span class="ow">or</span> <span class="p">(</span><span class="nb">hasattr</span><span class="p">(</span><span class="n">gm</span><span class="p">,</span> <span class="s2">&quot;projection&quot;</span><span class="p">)</span> <span class="ow">and</span>
                <span class="n">vcs</span><span class="o">.</span><span class="n">elements</span><span class="p">[</span><span class="s2">&quot;projection&quot;</span><span class="p">][</span>
                <span class="n">gm</span><span class="o">.</span><span class="n">projection</span><span class="p">]</span><span class="o">.</span><span class="n">type</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
                <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;linear&quot;</span><span class="p">,</span> <span class="s2">&quot;polar&quot;</span><span class="p">]</span> <span class="ow">and</span>
                <span class="n">numpy</span><span class="o">.</span><span class="n">allclose</span><span class="p">([</span><span class="n">datawc</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">datawc</span><span class="p">[</span><span class="mi">3</span><span class="p">]],</span> <span class="mf">1.e20</span><span class="p">)</span> <span class="ow">and</span>
                <span class="n">numpy</span><span class="o">.</span><span class="n">allclose</span><span class="p">([</span><span class="n">datawc</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">datawc</span><span class="p">[</span><span class="mi">1</span><span class="p">]],</span> <span class="mf">1.e20</span><span class="p">)):</span>
        <span class="n">wc</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">Y</span><span class="p">[:]</span><span class="o">.</span><span class="n">min</span><span class="p">()</span>
        <span class="n">wc</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="n">Y</span><span class="p">[:]</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">wc</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">==</span> <span class="n">wc</span><span class="p">[</span><span class="mi">2</span><span class="p">]:</span>
        <span class="n">wc</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">-=</span> <span class="o">.</span><span class="mi">0001</span>
        <span class="n">wc</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">+=</span> <span class="o">.</span><span class="mi">0001</span>
    <span class="k">if</span> <span class="n">numpy</span><span class="o">.</span><span class="n">allclose</span><span class="p">(</span><span class="n">wc</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">wc</span><span class="p">[</span><span class="mi">1</span><span class="p">]):</span>
        <span class="n">wc</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-=</span> <span class="o">.</span><span class="mi">0001</span>
        <span class="n">wc</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+=</span> <span class="o">.</span><span class="mi">0001</span>
    <span class="k">return</span> <span class="n">wc</span></div>


<div class="viewcode-block" id="rgba_color"><a class="viewcode-back" href="../../vcs/misc/utils.html#vcs.utils.rgba_color">[docs]</a><span class="k">def</span> <span class="nf">rgba_color</span><span class="p">(</span><span class="n">color</span><span class="p">,</span> <span class="n">colormap</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Try all of the various syntaxes of colors and return 0-100 RGBA values.</span>

<span class="sd">    :Example:</span>

<span class="sd">        .. doctest:: utils_rbga_color</span>

<span class="sd">            &gt;&gt;&gt; cp = vcs.getcolormap() # Get a copy of the default colormap</span>
<span class="sd">            &gt;&gt;&gt; vcs.rgba_color(&#39;black&#39;, cp) # Find the rgba equivalent for black</span>
<span class="sd">            [0.0, 0.0, 0.0, 100]</span>


<span class="sd">    :param color: The color to get the rgba value for. Can be an integer from 0-255, or a string name of a color.</span>
<span class="sd">    :type color: int, str</span>

<span class="sd">    :param colormap: A VCS colormap</span>
<span class="sd">    :type colormap: vcs.colormap.Cp</span>

<span class="sd">    :returns: List of 4 floats; the R, G, B, and A values associated with the given color.</span>
<span class="sd">    :rtype: list</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="c1"># Is it a colormap index?</span>
        <span class="k">return</span> <span class="n">colormap</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="n">color</span><span class="p">]</span>
    <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
        <span class="c1"># Is it a color tuple?</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">color</span><span class="p">)</span> <span class="o">==</span> <span class="mi">3</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="n">color</span><span class="p">)</span> <span class="o">==</span> <span class="mi">4</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">color</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="nb">int</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>
                <span class="k">except</span><span class="p">:</span>
                    <span class="k">break</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">any</span><span class="p">((</span><span class="n">c</span> <span class="o">&gt;</span> <span class="mi">100</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">color</span><span class="p">)):</span>
                    <span class="n">r</span><span class="p">,</span> <span class="n">g</span><span class="p">,</span> <span class="n">b</span> <span class="o">=</span> <span class="p">(</span><span class="n">c</span> <span class="o">/</span> <span class="mf">2.55</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">color</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">3</span><span class="p">])</span>
                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">color</span><span class="p">)</span> <span class="o">==</span> <span class="mi">4</span><span class="p">:</span>
                        <span class="n">a</span> <span class="o">=</span> <span class="n">color</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">/</span> <span class="mf">2.55</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">a</span> <span class="o">=</span> <span class="mi">100</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">r</span><span class="p">,</span> <span class="n">g</span><span class="p">,</span> <span class="n">b</span> <span class="o">=</span> <span class="n">color</span><span class="p">[:</span><span class="mi">3</span><span class="p">]</span>
                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">color</span><span class="p">)</span> <span class="o">==</span> <span class="mi">4</span><span class="p">:</span>
                        <span class="n">a</span> <span class="o">=</span> <span class="n">color</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">a</span> <span class="o">=</span> <span class="mi">100</span>
                <span class="k">return</span> <span class="p">[</span><span class="n">r</span><span class="p">,</span> <span class="n">g</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">a</span><span class="p">]</span>
    <span class="n">r</span><span class="p">,</span> <span class="n">g</span><span class="p">,</span> <span class="n">b</span> <span class="o">=</span> <span class="n">genutil</span><span class="o">.</span><span class="n">colors</span><span class="o">.</span><span class="n">str2rgb</span><span class="p">(</span><span class="n">color</span><span class="p">)</span>
    <span class="k">return</span> <span class="p">[</span><span class="n">r</span> <span class="o">/</span> <span class="mf">2.55</span><span class="p">,</span> <span class="n">g</span> <span class="o">/</span> <span class="mf">2.55</span><span class="p">,</span> <span class="n">b</span> <span class="o">/</span> <span class="mf">2.55</span><span class="p">,</span> <span class="mi">100</span><span class="p">]</span></div>


<span class="k">def</span> <span class="nf">png_read_metadata</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
    <span class="n">reader</span> <span class="o">=</span> <span class="n">vtk</span><span class="o">.</span><span class="n">vtkPNGReader</span><span class="p">()</span>
    <span class="n">reader</span><span class="o">.</span><span class="n">SetFileName</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
    <span class="n">reader</span><span class="o">.</span><span class="n">Update</span><span class="p">()</span>
    <span class="n">numberOfTextChunks</span> <span class="o">=</span> <span class="n">reader</span><span class="o">.</span><span class="n">GetNumberOfTextChunks</span><span class="p">()</span>
    <span class="n">m</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">numberOfTextChunks</span><span class="p">):</span>
        <span class="n">m</span><span class="p">[</span><span class="n">reader</span><span class="o">.</span><span class="n">GetTextKey</span><span class="p">(</span><span class="n">i</span><span class="p">)]</span> <span class="o">=</span> <span class="n">reader</span><span class="o">.</span><span class="n">GetTextValue</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">m</span>


<span class="k">def</span> <span class="nf">download_sample_data_files</span><span class="p">(</span><span class="n">path</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="kn">import</span> <span class="nn">requests</span>
    <span class="kn">import</span> <span class="nn">hashlib</span>
    <span class="k">if</span> <span class="n">path</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">path</span> <span class="o">=</span> <span class="n">vcs</span><span class="o">.</span><span class="n">sample_data</span>
    <span class="n">samples</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">vcs</span><span class="o">.</span><span class="n">prefix</span><span class="p">,</span> <span class="s2">&quot;share&quot;</span><span class="p">,</span> <span class="s2">&quot;vcs&quot;</span><span class="p">,</span> <span class="s2">&quot;sample_files.txt&quot;</span><span class="p">))</span><span class="o">.</span><span class="n">readlines</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">sample</span> <span class="ow">in</span> <span class="n">samples</span><span class="p">:</span>
        <span class="n">good_md5</span><span class="p">,</span> <span class="n">name</span> <span class="o">=</span> <span class="n">sample</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
        <span class="n">local_filename</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">local_filename</span><span class="p">))</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="k">pass</span>
        <span class="n">attempts</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">while</span> <span class="n">attempts</span> <span class="o">&lt;</span> <span class="mi">3</span><span class="p">:</span>
            <span class="n">md5</span> <span class="o">=</span> <span class="n">hashlib</span><span class="o">.</span><span class="n">md5</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">local_filename</span><span class="p">):</span>
                <span class="n">f</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">local_filename</span><span class="p">)</span>
                <span class="n">md5</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">())</span>
                <span class="k">if</span> <span class="n">md5</span><span class="o">.</span><span class="n">hexdigest</span><span class="p">()</span> <span class="o">==</span> <span class="n">good_md5</span><span class="p">:</span>
                    <span class="n">attempts</span> <span class="o">=</span> <span class="mi">5</span>
                    <span class="k">continue</span>
            <span class="nb">print</span> <span class="s2">&quot;Downloading:&quot;</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="s2">&quot;in&quot;</span><span class="p">,</span> <span class="n">local_filename</span>
            <span class="n">r</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;http://uvcdat.llnl.gov/cdat/sample_data/&quot;</span> <span class="o">+</span> <span class="n">name</span><span class="p">,</span> <span class="n">stream</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">local_filename</span><span class="p">,</span> <span class="s1">&#39;wb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">chunk</span> <span class="ow">in</span> <span class="n">r</span><span class="o">.</span><span class="n">iter_content</span><span class="p">(</span><span class="n">chunk_size</span><span class="o">=</span><span class="mi">1024</span><span class="p">):</span>
                    <span class="k">if</span> <span class="n">chunk</span><span class="p">:</span>  <span class="c1"># filter local_filename keep-alive new chunks</span>
                        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">chunk</span><span class="p">)</span>
                        <span class="n">md5</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">chunk</span><span class="p">)</span>
            <span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">md5</span><span class="o">.</span><span class="n">hexdigest</span><span class="p">()</span> <span class="o">==</span> <span class="n">good_md5</span><span class="p">:</span>
                <span class="n">attempts</span> <span class="o">=</span> <span class="mi">5</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">attempts</span> <span class="o">+=</span> <span class="mi">1</span>
</pre></div>

          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="../../index.html">
              <img class="logo" src="../../_static/uvcdat.png" alt="Logo"/>
            </a></p>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="../../search.html" method="get">
      <div><input type="text" name="q" /></div>
      <div><input type="submit" value="Go" /></div>
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../index.html">VCS 2.4.1 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../index.html" >Module code</a> &#187;</li>
          <li class="nav-item nav-item-2"><a href="../vcs.html" >vcs</a> &#187;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2016, LLNL.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.4.6.
    </div>
  </body>
</html>